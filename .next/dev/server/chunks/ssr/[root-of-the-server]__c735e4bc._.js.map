{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///D:/document-versioning-ui/app/compare/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useParams } from \"next/navigation\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport ReactMarkdown from 'react-markdown';\r\nimport remarkGfm from 'remark-gfm';\r\nimport {\r\n  ArrowPathIcon,\r\n  ExclamationTriangleIcon,\r\n  DocumentMagnifyingGlassIcon,\r\n  ClipboardIcon,\r\n  LightBulbIcon,\r\n  ChatBubbleLeftRightIcon,\r\n  SparklesIcon,\r\n  MagnifyingGlassIcon,\r\n  FunnelIcon,\r\n  InformationCircleIcon,\r\n  DocumentArrowDownIcon,\r\n  AdjustmentsHorizontalIcon,\r\n  ArrowsPointingOutIcon,\r\n  ArrowsPointingInIcon,\r\n  XMarkIcon,\r\n  ChevronLeftIcon,\r\n  ChevronRightIcon,\r\n} from \"@heroicons/react/24/outline\";\r\n\r\n/* ================= TYPES ================= */\r\n\r\ntype ChangeType = \"ADDED\" | \"REMOVED\" | \"MODIFIED\";\r\ntype RiskLevel = \"LOW\" | \"MEDIUM\" | \"HIGH\";\r\n\r\ntype ChangeItem = {\r\n  id: number;\r\n  change_type: ChangeType;\r\n  section_label: string | null;\r\n  old_text: string | null;\r\n  new_text: string | null;\r\n  risk_level?: RiskLevel | null;\r\n  ai_comment?: string | null;\r\n  ai_suggestion?: string | null;\r\n  risk_reason?: string | null;\r\n};\r\n\r\ntype ComparisonDetail = {\r\n  id: number;\r\n  document_name: string;\r\n  version_old_label: string;\r\n  version_new_label: string;\r\n  created_at: string;\r\n  overall_risk_level?: string | null;\r\n  summary_text?: string | null;\r\n  changes: ChangeItem[];\r\n};\r\n\r\nconst API_BASE =\r\n  process.env.NEXT_PUBLIC_API_BASE?.trim() || \"http://127.0.0.1:8000\";\r\n\r\n/* ================= SIMPLE MARKDOWN RENDERER ================= */\r\n\r\ninterface MarkdownRendererProps {\r\n  content: string;\r\n  className?: string;\r\n}\r\n\r\nfunction MarkdownRenderer({ content, className = \"\" }: MarkdownRendererProps) {\r\n  // ถ้า content เป็น null หรือ undefined ให้แสดง \"ไม่มีข้อมูล\"\r\n  if (!content || content.trim() === '') {\r\n    return (\r\n      <div className={`text-gray-400 italic ${className}`}>\r\n        ไม่มีข้อมูล\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`markdown-content prose prose-sm max-w-none ${className}`}>\r\n      <ReactMarkdown\r\n        remarkPlugins={[remarkGfm]}\r\n        components={{\r\n          h1: ({ node, ...props }) => (\r\n            <h1 className=\"text-2xl font-bold text-gray-900 mt-6 mb-3 pb-2 border-b border-gray-200\" {...props} />\r\n          ),\r\n          h2: ({ node, ...props }) => (\r\n            <h2 className=\"text-xl font-bold text-gray-900 mt-5 mb-2\" {...props} />\r\n          ),\r\n          h3: ({ node, ...props }) => (\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mt-4 mb-2\" {...props} />\r\n          ),\r\n          p: ({ node, ...props }) => (\r\n            <p className=\"text-gray-700 leading-relaxed my-2\" {...props} />\r\n          ),\r\n          ul: ({ node, ...props }) => (\r\n            <ul className=\"list-disc pl-6 space-y-1 my-3\" {...props} />\r\n          ),\r\n          ol: ({ node, ...props }) => (\r\n            <ol className=\"list-decimal pl-6 space-y-1 my-3\" {...props} />\r\n          ),\r\n          li: ({ node, ...props }) => (\r\n            <li className=\"text-gray-700 leading-relaxed\" {...props} />\r\n          ),\r\n          strong: ({ node, ...props }) => (\r\n            <strong className=\"font-bold text-gray-900\" {...props} />\r\n          ),\r\n          em: ({ node, ...props }) => (\r\n            <em className=\"italic text-gray-800\" {...props} />\r\n          ),\r\n          code: ({ node, inline, className, children, ...props }: any) => {\r\n            if (inline) {\r\n              return (\r\n                <code className=\"bg-gray-100 px-1.5 py-0.5 rounded font-mono text-sm\" {...props}>\r\n                  {children}\r\n                </code>\r\n              );\r\n            }\r\n            return (\r\n              <code className={`${className} block bg-gray-800 text-gray-100 p-4 rounded-lg overflow-x-auto my-3 font-mono text-sm`} {...props}>\r\n                {children}\r\n              </code>\r\n            );\r\n          },\r\n          pre: ({ node, ...props }) => (\r\n            <pre className=\"bg-gray-800 text-gray-100 p-4 rounded-lg overflow-x-auto my-3 font-mono text-sm\" {...props} />\r\n          ),\r\n          a: ({ node, ...props }) => (\r\n            <a \r\n              className=\"text-blue-600 hover:text-blue-800 underline font-medium\" \r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              {...props}\r\n            />\r\n          ),\r\n          table: ({ node, ...props }) => (\r\n            <div className=\"overflow-x-auto my-4 rounded-lg border border-gray-200\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\" {...props} />\r\n            </div>\r\n          ),\r\n          thead: ({ node, ...props }) => (\r\n            <thead className=\"bg-gradient-to-r from-gray-50 to-gray-100\" {...props} />\r\n          ),\r\n          tbody: ({ node, ...props }) => (\r\n            <tbody className=\"bg-white divide-y divide-gray-200\" {...props} />\r\n          ),\r\n          th: ({ node, ...props }) => (\r\n            <th className=\"px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r border-gray-300 last:border-r-0\" {...props} />\r\n          ),\r\n          td: ({ node, ...props }) => (\r\n            <td className=\"px-4 py-3 text-sm text-gray-800 border-r border-gray-200 last:border-r-0\" {...props} />\r\n          ),\r\n          blockquote: ({ node, ...props }) => (\r\n            <blockquote className=\"border-l-4 border-blue-500 pl-4 italic text-gray-600 my-3\" {...props} />\r\n          ),\r\n          hr: ({ node, ...props }) => (\r\n            <hr className=\"my-4 border-t border-gray-300\" {...props} />\r\n          ),\r\n        }}\r\n      >\r\n        {content}\r\n      </ReactMarkdown>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ================= HELPERS ================= */\r\n\r\nfunction normalizeText(s?: string | null) {\r\n  return (s || \"\").toString().trim();\r\n}\r\n\r\nfunction contains(hay: string, needle: string) {\r\n  return hay.toLowerCase().includes(needle.toLowerCase());\r\n}\r\n\r\nfunction formatDateTime(iso: string) {\r\n  try {\r\n    return new Date(iso).toLocaleString(\"th-TH\", {\r\n      year: \"numeric\",\r\n      month: \"short\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction riskBadge(risk?: string | null) {\r\n  const base = \"px-3 py-1 rounded-md font-bold\";\r\n  const level = (risk || \"LOW\").toUpperCase();\r\n\r\n  if (level === \"HIGH\")\r\n    return <span className={`${base} bg-gradient-to-r from-red-500 to-red-600 text-white text-sm shadow-sm`}>HIGH</span>;\r\n  if (level === \"MEDIUM\")\r\n    return <span className={`${base} bg-gradient-to-r from-amber-500 to-amber-600 text-white text-sm shadow-sm`}>MEDIUM</span>;\r\n  return <span className={`${base} bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm shadow-sm`}>LOW</span>;\r\n}\r\n\r\nfunction changeTypeBadge(type: ChangeType) {\r\n  const base = \"px-3 py-1 rounded-md font-bold\";\r\n  if (type === \"ADDED\")\r\n    return <span className={`${base} bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm shadow-sm`}>ADDED</span>;\r\n  if (type === \"REMOVED\")\r\n    return <span className={`${base} bg-gradient-to-r from-red-500 to-red-600 text-white text-sm shadow-sm`}>REMOVED</span>;\r\n  return <span className={`${base} bg-gradient-to-r from-amber-500 to-amber-600 text-white text-sm shadow-sm`}>MODIFIED</span>;\r\n}\r\n\r\nasync function copyToClipboard(text: string) {\r\n  try {\r\n    await navigator.clipboard.writeText(text);\r\n    return true;\r\n  } catch {\r\n    try {\r\n      const el = document.createElement(\"textarea\");\r\n      el.value = text;\r\n      document.body.appendChild(el);\r\n      el.select();\r\n      document.execCommand(\"copy\");\r\n      document.body.removeChild(el);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nfunction CopyButton({ text, label = \"คัดลอก\", size = \"md\", variant = \"default\" }: {\r\n  text: string;\r\n  label?: string;\r\n  size?: \"sm\" | \"md\";\r\n  variant?: \"default\" | \"primary\";\r\n}) {\r\n  const disabled = !text || text.trim().length === 0;\r\n  \r\n  const baseClasses = `\r\n    inline-flex items-center gap-1 ${size === \"sm\" ? \"px-3 py-1.5 text-sm\" : \"px-4 py-2 text-base\"}\r\n    rounded-lg font-medium transition-all duration-200\r\n    ${disabled ? \"opacity-50 cursor-not-allowed\" : \"hover:scale-[1.02] active:scale-[0.98]\"}\r\n  `;\r\n  \r\n  const variantClasses = variant === \"primary\" \r\n    ? \"bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 shadow-sm\"\r\n    : \"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 hover:border-gray-400\";\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      disabled={disabled}\r\n      onClick={async () => await copyToClipboard(text)}\r\n      className={`${baseClasses} ${variantClasses}`}\r\n    >\r\n      <ClipboardIcon className=\"h-4 w-4\" />\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n\r\n/* ================= DIFF VIEW COMPONENT ================= */\r\n\r\nfunction DiffView({ oldText, newText }: { oldText: string; newText: string }) {\r\n  const oldWords = oldText.split(/(\\s+)/);\r\n  const newWords = newText.split(/(\\s+)/);\r\n  const oldSet = new Set(oldWords.filter(w => w.trim().length > 0));\r\n  const newSet = new Set(newWords.filter(w => w.trim().length > 0));\r\n\r\n  return (\r\n    <div className=\"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm\">\r\n      <div className=\"grid grid-cols-2 divide-x divide-gray-200\">\r\n        <div className=\"p-4 bg-gradient-to-b from-red-50/70 via-white to-red-50/30\">\r\n          <div className=\"flex items-center gap-2 mb-3\">\r\n            <div className=\"h-3 w-3 bg-red-500 rounded-full shadow-sm\"></div>\r\n            <div className=\"text-sm font-bold text-red-700 bg-red-100 px-3 py-1 rounded-full\">OLD VERSION</div>\r\n          </div>\r\n          <div className=\"text-base leading-relaxed text-gray-800 bg-white/50 p-3 rounded-lg border border-red-100\">\r\n            {oldWords.map((w, i) => (\r\n              <span\r\n                key={i}\r\n                className={!newSet.has(w) && w.trim().length > 0 ? \r\n                  \"bg-red-100 text-red-900 px-1 py-0.5 rounded mx-0.5 border border-red-200 font-medium shadow-sm\" : \r\n                  \"text-gray-700\"\r\n                }\r\n              >\r\n                {w}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"p-4 bg-gradient-to-b from-emerald-50/70 via-white to-emerald-50/30\">\r\n          <div className=\"flex items-center gap-2 mb-3\">\r\n            <div className=\"h-3 w-3 bg-emerald-500 rounded-full shadow-sm\"></div>\r\n            <div className=\"text-sm font-bold text-emerald-700 bg-emerald-100 px-3 py-1 rounded-full\">NEW VERSION</div>\r\n          </div>\r\n          <div className=\"text-base leading-relaxed text-gray-800 bg-white/50 p-3 rounded-lg border border-emerald-100\">\r\n            {newWords.map((w, i) => (\r\n              <span\r\n                key={i}\r\n                className={!oldSet.has(w) && w.trim().length > 0 ? \r\n                  \"bg-emerald-100 text-emerald-900 px-1 py-0.5 rounded mx-0.5 border border-emerald-200 font-medium shadow-sm\" : \r\n                  \"text-gray-700\"\r\n                }\r\n              >\r\n                {w}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ExpandableText({ text, title, maxLength = 300, type = \"normal\" }: { \r\n  text: string | null | undefined; \r\n  title?: string;\r\n  maxLength?: number;\r\n  type?: \"normal\" | \"ai\";\r\n}) {\r\n  const raw = normalizeText(text);\r\n  const [expanded, setExpanded] = useState(false);\r\n  const isLong = raw.length > maxLength;\r\n  const shown = expanded ? raw : raw.slice(0, maxLength) + (isLong ? \"...\" : \"\");\r\n\r\n  const bgColor = type === \"ai\" ? \"bg-gradient-to-br from-blue-50/80 to-blue-100/50\" : \"bg-gray-50\";\r\n\r\n  return (\r\n    <div className={`rounded-xl p-4 ${bgColor} border ${type === \"ai\" ? \"border-blue-200\" : \"border-gray-200\"}`}>\r\n      {title && (\r\n        <div className=\"flex items-center gap-2 mb-3\">\r\n          <span className=\"text-base font-bold text-gray-900\">{title}</span>\r\n        </div>\r\n      )}\r\n      <div className=\"text-base text-gray-800 leading-relaxed font-normal\">\r\n        {type === \"ai\" ? (\r\n          <MarkdownRenderer content={shown} />\r\n        ) : (\r\n          <span className=\"whitespace-pre-wrap\">\r\n            {raw || <span className=\"text-gray-400 italic\">ไม่มีข้อมูล</span>}\r\n          </span>\r\n        )}\r\n      </div>\r\n      {isLong && (\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setExpanded(!expanded)}\r\n          className=\"mt-3 px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-800 bg-white border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors\"\r\n        >\r\n          {expanded ? \"ย่อข้อความ\" : \"อ่านต่อ...\"}\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ================= AI CHAT COMPONENT ================= */\r\n\r\nfunction AIChat({ change }: { change: ChangeItem }) {\r\n  const [chatOpen, setChatOpen] = useState(false);\r\n  const [chatQuestion, setChatQuestion] = useState(\"\");\r\n  const [chatLoading, setChatLoading] = useState(false);\r\n  const [chatAnswer, setChatAnswer] = useState(\"\");\r\n  const [chatError, setChatError] = useState<string | null>(null);\r\n\r\n  const sendChat = async () => {\r\n    const question = normalizeText(chatQuestion);\r\n    if (!question) return;\r\n\r\n    setChatLoading(true);\r\n    setChatError(null);\r\n\r\n    try {\r\n      const res = await fetch(`${API_BASE}/changes/${change.id}/chat`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ \r\n          question,\r\n          mode: \"detailed\"\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) throw new Error(`Chat failed (${res.status})`);\r\n      const data = await res.json();\r\n\r\n      setChatAnswer(normalizeText(data?.answer) || \"\");\r\n    } catch (e: any) {\r\n      setChatError(e?.message || \"ส่งคำถามไม่สำเร็จ\");\r\n    } finally {\r\n      setChatLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* AI Analysis Grid */}\r\n      <div className=\"grid md:grid-cols-2 gap-4\">\r\n        {/* AI Comment */}\r\n        <div className=\"rounded-xl overflow-hidden border border-blue-200 bg-gradient-to-br from-blue-50/80 to-white shadow-sm\">\r\n          <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <InformationCircleIcon className=\"h-5 w-5 text-white\" />\r\n                <h3 className=\"text-base font-bold text-white\">ความคิดเห็นจาก AI</h3>\r\n              </div>\r\n              <CopyButton text={normalizeText(change.ai_comment)} size=\"sm\" variant=\"primary\" />\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4\">\r\n            <MarkdownRenderer content={normalizeText(change.ai_comment)} />\r\n          </div>\r\n        </div>\r\n\r\n        {/* AI Suggestion */}\r\n        <div className=\"rounded-xl overflow-hidden border border-amber-200 bg-gradient-to-br from-amber-50/80 to-white shadow-sm\">\r\n          <div className=\"bg-gradient-to-r from-amber-600 to-amber-700 px-4 py-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <LightBulbIcon className=\"h-5 w-5 text-white\" />\r\n                <h3 className=\"text-base font-bold text-white\">คำแนะนำจาก AI</h3>\r\n              </div>\r\n              <CopyButton text={normalizeText(change.ai_suggestion)} size=\"sm\" variant=\"primary\" />\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4\">\r\n            <MarkdownRenderer content={normalizeText(change.ai_suggestion)} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Risk Reason */}\r\n      {normalizeText(change.risk_reason) && (\r\n        <div className=\"rounded-xl border border-gray-200 bg-gradient-to-br from-gray-50/80 to-white p-4 shadow-sm\">\r\n          <div className=\"flex items-center gap-2 mb-2\">\r\n            <ExclamationTriangleIcon className=\"h-5 w-5 text-gray-700\" />\r\n            <h3 className=\"text-base font-bold text-gray-900\">เหตุผลระดับความเสี่ยง</h3>\r\n          </div>\r\n          <div className=\"text-base text-gray-700 leading-relaxed\">\r\n            <MarkdownRenderer content={normalizeText(change.risk_reason)} />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* AI Chat Interface */}\r\n      <div className=\"rounded-xl border border-purple-200 overflow-hidden bg-gradient-to-br from-purple-50/30 to-white shadow-sm\">\r\n        <button\r\n          onClick={() => setChatOpen(!chatOpen)}\r\n          className=\"w-full px-4 py-3 bg-gradient-to-r from-purple-600 to-purple-700 flex items-center justify-between hover:from-purple-700 hover:to-purple-800 transition-all\"\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            <ChatBubbleLeftRightIcon className=\"h-5 w-5 text-white\" />\r\n            <span className=\"text-base font-bold text-white\">ถาม AI เพิ่มเติมเกี่ยวกับจุดนี้</span>\r\n          </div>\r\n          <span className=\"text-white font-bold\">{chatOpen ? \"▲\" : \"▼\"}</span>\r\n        </button>\r\n\r\n        {chatOpen && (\r\n          <div className=\"p-4\">\r\n            <div className=\"mb-4\">\r\n              <label className=\"block text-sm font-bold text-gray-700 mb-2\">คำถามของคุณ</label>\r\n              <textarea\r\n                value={chatQuestion}\r\n                onChange={(e) => setChatQuestion(e.target.value)}\r\n                placeholder=\"พิมพ์คำถามเกี่ยวกับการเปลี่ยนแปลงนี้...\"\r\n                rows={3}\r\n                className=\"w-full px-4 py-3 text-base border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\r\n              />\r\n            </div>\r\n\r\n            {chatError && (\r\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl\">\r\n                <p className=\"text-sm text-red-700 flex items-center gap-2\">\r\n                  <ExclamationTriangleIcon className=\"h-4 w-4\" />\r\n                  {chatError}\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={sendChat}\r\n                disabled={chatLoading || !chatQuestion.trim()}\r\n                className=\"px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 font-medium disabled:opacity-50 transition-all\"\r\n              >\r\n                {chatLoading ? (\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <ArrowPathIcon className=\"h-4 w-4 animate-spin\" />\r\n                    กำลังวิเคราะห์...\r\n                  </div>\r\n                ) : \"ส่งคำถาม\"}\r\n              </button>\r\n              <CopyButton text={chatAnswer} label=\"คัดลอกคำตอบ\" variant=\"primary\" />\r\n            </div>\r\n\r\n            {chatAnswer && (\r\n              <div className=\"mt-4 p-4 bg-gradient-to-br from-blue-50/50 to-white border border-blue-200 rounded-xl\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <SparklesIcon className=\"h-5 w-5 text-blue-600\" />\r\n                  <h4 className=\"text-base font-bold text-gray-900\">คำตอบจาก AI</h4>\r\n                </div>\r\n                <div className=\"text-base text-gray-800 leading-relaxed\">\r\n                  <MarkdownRenderer content={chatAnswer} />\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ================= MAIN PAGE ================= */\r\n\r\nexport default function CompareReportPage() {\r\n  const { id } = useParams<{ id: string }>();\r\n  const [detail, setDetail] = useState<ComparisonDetail | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [riskFilter, setRiskFilter] = useState<\"ALL\" | RiskLevel>(\"ALL\");\r\n  const [typeFilter, setTypeFilter] = useState<\"ALL\" | ChangeType>(\"ALL\");\r\n  const [annotating, setAnnotating] = useState(false);\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [showFullscreen, setShowFullscreen] = useState(false);\r\n  const [fullscreenChangeIndex, setFullscreenChangeIndex] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (id) loadDetail();\r\n  }, [id]);\r\n\r\n  const loadDetail = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comparisons/${id}`, { cache: \"no-store\" });\r\n      if (!res.ok) throw new Error(`Failed to load (${res.status})`);\r\n      const data: ComparisonDetail = await res.json();\r\n      setDetail(data);\r\n    } catch (err: any) {\r\n      setError(err?.message || \"โหลดข้อมูลไม่สำเร็จ\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAnnotate = async () => {\r\n    if (!id) return;\r\n    setAnnotating(true);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comparisons/${id}/annotate`, { method: \"POST\" });\r\n      if (!res.ok) throw new Error(`Annotation failed (${res.status})`);\r\n      await loadDetail();\r\n    } catch (err: any) {\r\n      console.error(\"Annotation error:\", err);\r\n    } finally {\r\n      setAnnotating(false);\r\n    }\r\n  };\r\n\r\n  const handleOpenFullscreen = (index: number) => {\r\n    setFullscreenChangeIndex(index);\r\n    setShowFullscreen(true);\r\n  };\r\n\r\n  const filteredChanges = useMemo(() => {\r\n    const changes = detail?.changes || [];\r\n    const query = searchQuery.trim();\r\n\r\n    return changes.filter(c => {\r\n      if (riskFilter !== \"ALL\") {\r\n        const lv = (c.risk_level || \"LOW\").toUpperCase();\r\n        if (lv !== riskFilter) return false;\r\n      }\r\n\r\n      if (typeFilter !== \"ALL\") {\r\n        if (c.change_type !== typeFilter) return false;\r\n      }\r\n\r\n      if (query.length > 0) {\r\n        const hay = [\r\n          c.section_label,\r\n          c.old_text,\r\n          c.new_text,\r\n          c.ai_comment,\r\n          c.ai_suggestion,\r\n          c.risk_reason,\r\n          c.change_type,\r\n          c.risk_level,\r\n        ]\r\n          .map(x => normalizeText(x as any))\r\n          .join(\" | \");\r\n\r\n        if (!contains(hay, query)) return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }, [detail?.changes, searchQuery, riskFilter, typeFilter]);\r\n\r\n  const riskSummary = useMemo(() => {\r\n    const changes = detail?.changes || [];\r\n    return {\r\n      HIGH: changes.filter(c => c.risk_level === \"HIGH\").length,\r\n      MEDIUM: changes.filter(c => c.risk_level === \"MEDIUM\").length,\r\n      LOW: changes.filter(c => c.risk_level === \"LOW\").length,\r\n      TOTAL: changes.length,\r\n    };\r\n  }, [detail?.changes]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <ArrowPathIcon className=\"h-12 w-12 animate-spin text-blue-600 mx-auto\" />\r\n          <p className=\"mt-4 text-lg text-gray-700 font-medium\">กำลังโหลดรายงาน...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !detail) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center p-6\">\r\n        <div className=\"bg-white border border-red-200 rounded-xl p-8 max-w-md shadow-sm\">\r\n          <ExclamationTriangleIcon className=\"h-12 w-12 text-red-500 mx-auto\" />\r\n          <h2 className=\"text-xl font-bold text-gray-900 mt-4 text-center\">ไม่พบรายงาน</h2>\r\n          <p className=\"text-gray-600 mt-2 text-center\">{error || \"ไม่พบข้อมูลการเปรียบเทียบนี้\"}</p>\r\n          <button\r\n            onClick={loadDetail}\r\n            className=\"mt-6 w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-sm\"\r\n          >\r\n            โหลดใหม่\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* Header */}\r\n      <div className=\"min-h-screen bg-gradient-to-b from-gray-50/50 to-gray-100 p-4 md:p-6\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          <div className=\"mb-8\">\r\n            <div className=\"bg-white rounded-2xl border border-gray-200 shadow-sm p-6\">\r\n              <div className=\"flex flex-col lg:flex-row lg:items-start justify-between gap-6\">\r\n                <div className=\"flex-1\">\r\n                  <h1 className=\"text-2xl lg:text-3xl font-bold text-gray-900 mb-3\">\r\n                    {detail.document_name}\r\n                  </h1>\r\n                  <div className=\"flex flex-wrap items-center gap-3 text-gray-700 mb-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm rounded-lg font-semibold shadow-sm\">\r\n                        {detail.version_old_label}\r\n                      </span>\r\n                      <span className=\"text-gray-500\">→</span>\r\n                      <span className=\"px-3 py-1.5 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm rounded-lg font-semibold shadow-sm\">\r\n                        {detail.version_new_label}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <span className=\"text-gray-500\">•</span>\r\n                      {formatDateTime(detail.created_at)}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <span className=\"text-gray-500\">•</span>\r\n                      <span>ID: {detail.id}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col items-start lg:items-end gap-4\">\r\n                  <div className=\"text-right\">\r\n                    <div className=\"text-sm text-gray-600 font-medium mb-1\">ความเสี่ยงรวม</div>\r\n                    <div className={`text-2xl font-bold ${\r\n                      detail.overall_risk_level?.includes(\"HIGH\") ? \"text-red-600\" :\r\n                      detail.overall_risk_level?.includes(\"MEDIUM\") ? \"text-amber-600\" :\r\n                      \"text-emerald-600\"\r\n                    }`}>\r\n                      {detail.overall_risk_level || \"ไม่ระบุ\"}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex flex-col sm:flex-row gap-2\">\r\n                    <Link\r\n                      href={`/reports/generate?comparisonId=${detail.id}`}\r\n                      className=\"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 font-medium shadow-sm\"\r\n                    >\r\n                      <DocumentArrowDownIcon className=\"h-4 w-4\" />\r\n                      สร้างรายงาน\r\n                    </Link>\r\n                    \r\n                    <button\r\n                      onClick={handleAnnotate}\r\n                      disabled={annotating}\r\n                      className=\"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg hover:from-purple-700 hover:to-purple-800 disabled:opacity-70 font-medium shadow-sm\"\r\n                    >\r\n                      {annotating ? (\r\n                        <ArrowPathIcon className=\"h-4 w-4 animate-spin\" />\r\n                      ) : (\r\n                        <SparklesIcon className=\"h-4 w-4\" />\r\n                      )}\r\n                      {annotating ? \"กำลังวิเคราะห์...\" : \"AI วิเคราะห์ใหม่\"}\r\n                    </button>\r\n                    \r\n                    <button\r\n                      onClick={() => setShowFilters(!showFilters)}\r\n                      className=\"flex items-center gap-2 px-4 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium shadow-sm\"\r\n                    >\r\n                      <AdjustmentsHorizontalIcon className=\"h-4 w-4\" />\r\n                      ฟิลเตอร์\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Risk Summary */}\r\n              <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                  <div className=\"bg-gradient-to-br from-red-50 to-white border border-red-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-red-700\">{riskSummary.HIGH}</div>\r\n                    <div className=\"text-sm font-medium text-red-600\">HIGH RISK</div>\r\n                  </div>\r\n                  <div className=\"bg-gradient-to-br from-amber-50 to-white border border-amber-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-amber-700\">{riskSummary.MEDIUM}</div>\r\n                    <div className=\"text-sm font-medium text-amber-600\">MEDIUM RISK</div>\r\n                  </div>\r\n                  <div className=\"bg-gradient-to-br from-emerald-50 to-white border border-emerald-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-emerald-700\">{riskSummary.LOW}</div>\r\n                    <div className=\"text-sm font-medium text-emerald-600\">LOW RISK</div>\r\n                  </div>\r\n                  <div className=\"bg-gradient-to-br from-blue-50 to-white border border-blue-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-blue-700\">{riskSummary.TOTAL}</div>\r\n                    <div className=\"text-sm font-medium text-blue-600\">TOTAL CHANGES</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* AI Summary */}\r\n            {detail.summary_text && (\r\n              <div className=\"mt-6 bg-gradient-to-br from-blue-50/80 to-white rounded-2xl border border-blue-200 shadow-sm p-6\">\r\n                <div className=\"flex items-center gap-3 mb-4\">\r\n                  <DocumentMagnifyingGlassIcon className=\"h-6 w-6 text-blue-600\" />\r\n                  <h2 className=\"text-xl font-bold text-gray-900\">สรุปผลการวิเคราะห์</h2>\r\n                </div>\r\n                <div className=\"text-base text-gray-800 leading-relaxed bg-white/50 border border-blue-100 rounded-xl p-4\">\r\n                  <MarkdownRenderer content={detail.summary_text} />\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Changes List */}\r\n          <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h2 className=\"text-xl font-bold text-gray-900\">รายการเปลี่ยนแปลง</h2>\r\n              <div className=\"text-sm text-gray-600\">\r\n                {filteredChanges.length} รายการ\r\n              </div>\r\n            </div>\r\n\r\n            {filteredChanges.length === 0 ? (\r\n              <div className=\"bg-white rounded-2xl border border-gray-200 p-8 text-center shadow-sm\">\r\n                <p className=\"text-lg text-gray-500\">ไม่พบรายการเปลี่ยนแปลงตามเงื่อนไขที่เลือก</p>\r\n              </div>\r\n            ) : (\r\n              filteredChanges.map((change, index) => (\r\n                <div key={change.id} className=\"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                  {/* Header */}\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-white border-b border-gray-200 p-5\">\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-3\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {changeTypeBadge(change.change_type)}\r\n                        <h3 className=\"text-lg font-bold text-gray-900\">\r\n                          {change.section_label || \"ไม่มีหัวข้อ\"}\r\n                        </h3>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {riskBadge(change.risk_level)}\r\n                        <span className=\"text-sm text-gray-500\">ID: {change.id}</span>\r\n                      </div>\r\n                    </div>                                              \r\n                  </div>\r\n\r\n                  {/* Content */}\r\n                  <div className=\"p-5 space-y-6\">\r\n                    {/* Diff View */}\r\n                    <div>\r\n                      <h4 className=\"text-base font-bold text-gray-800 mb-3\">การเปลี่ยนแปลงข้อความ</h4>\r\n                      <DiffView\r\n                        oldText={normalizeText(change.old_text)}\r\n                        newText={normalizeText(change.new_text)}\r\n                      />\r\n                    </div>\r\n\r\n                    {/* AI Analysis Section */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-3 mb-4\">\r\n                        <div className=\"h-8 w-1 bg-gradient-to-b from-purple-500 to-purple-600 rounded-full\"></div>\r\n                        <h4 className=\"text-lg font-bold text-gray-900\">การวิเคราะห์ด้วย AI</h4>\r\n                      </div>\r\n                      <AIChat change={change} />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}