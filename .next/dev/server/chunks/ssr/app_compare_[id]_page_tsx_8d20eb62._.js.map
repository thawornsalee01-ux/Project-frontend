{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/app/compare/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useRef } from \"react\"\r\n\r\nimport { useParams } from \"next/navigation\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport {\r\n  ArrowPathIcon,\r\n  ExclamationTriangleIcon,\r\n  DocumentMagnifyingGlassIcon,\r\n  ClipboardIcon,\r\n  LightBulbIcon,\r\n  ChatBubbleLeftRightIcon,\r\n  SparklesIcon,\r\n  MagnifyingGlassIcon,\r\n  FunnelIcon,\r\n  InformationCircleIcon,\r\n  DocumentArrowDownIcon,\r\n  AdjustmentsHorizontalIcon,\r\n  ArrowsPointingOutIcon,\r\n  ArrowsPointingInIcon,\r\n  XMarkIcon,\r\n  ChevronLeftIcon,\r\n  ChevronRightIcon,\r\n} from \"@heroicons/react/24/outline\";\r\n\r\n/* ================= TYPES ================= */\r\n\r\ntype ChangeType = \"ADDED\" | \"REMOVED\" | \"MODIFIED\";\r\ntype RiskLevel = \"LOW\" | \"MEDIUM\" | \"HIGH\";\r\n\r\ntype ChangeItem = {\r\n  id: number;\r\n  change_type: ChangeType;\r\n  section_label: string | null;\r\n  old_text: string | null;\r\n  new_text: string | null;\r\n  risk_level?: RiskLevel | null;\r\n  ai_comment?: string | null;\r\n  ai_suggestion?: string | null;\r\n  risk_reason?: string | null;\r\n};\r\n\r\ntype ComparisonDetail = {\r\n  id: number;\r\n  document_name: string;\r\n  version_old_label: string;\r\n  version_new_label: string;\r\n  created_at: string;\r\n  overall_risk_level?: string | null;\r\n  summary_text?: string | null;\r\n  changes: ChangeItem[];\r\n};\r\n\r\ntype ChatState = {\r\n  open: boolean;\r\n  question: string;\r\n  loading: boolean;\r\n  answer: string;\r\n  error: string | null;\r\n};\r\n\r\nconst API_BASE = process.env.NEXT_PUBLIC_HISTORY_API ?? \"/api/history\";\r\nconst API_BASE_CHAT = process.env.NEXT_PUBLIC_HISTORY_CHAT_API ?? \"/api/chat\";\r\n\r\n\r\n/* ================= HELPERS ================= */\r\n\r\nfunction normalizeText(s?: string | null) {\r\n  return (s || \"\").toString().trim();\r\n}\r\n\r\nfunction contains(hay: string, needle: string) {\r\n  return hay.toLowerCase().includes(needle.toLowerCase());\r\n}\r\n\r\nfunction formatDateTime(iso: string) {\r\n  try {\r\n    return new Date(iso).toLocaleString(\"th-TH\", {\r\n      year: \"numeric\",\r\n      month: \"short\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction riskBadge(risk?: string | null) {\r\n  const base = \"px-3 py-1 rounded-md font-bold\";\r\n  const level = (risk || \"LOW\").toUpperCase();\r\n\r\n  if (level === \"HIGH\")\r\n    return <span className={`${base} bg-gradient-to-r from-red-500 to-red-600 text-white text-sm shadow-sm`}>HIGH</span>;\r\n  if (level === \"MEDIUM\")\r\n    return <span className={`${base} bg-gradient-to-r from-amber-500 to-amber-600 text-white text-sm shadow-sm`}>MEDIUM</span>;\r\n  return <span className={`${base} bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm shadow-sm`}>LOW</span>;\r\n}\r\n\r\nfunction changeTypeBadge(type: ChangeType) {\r\n  const base = \"px-3 py-1 rounded-md font-bold\";\r\n  if (type === \"ADDED\")\r\n    return <span className={`${base} bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm shadow-sm`}>ADDED</span>;\r\n  if (type === \"REMOVED\")\r\n    return <span className={`${base} bg-gradient-to-r from-red-500 to-red-600 text-white text-sm shadow-sm`}>REMOVED</span>;\r\n  return <span className={`${base} bg-gradient-to-r from-amber-500 to-amber-600 text-white text-sm shadow-sm`}>MODIFIED</span>;\r\n}\r\n\r\nasync function copyToClipboard(text: string) {\r\n  try {\r\n    await navigator.clipboard.writeText(text);\r\n    return true;\r\n  } catch {\r\n    try {\r\n      const el = document.createElement(\"textarea\");\r\n      el.value = text;\r\n      document.body.appendChild(el);\r\n      el.select();\r\n      document.execCommand(\"copy\");\r\n      document.body.removeChild(el);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nfunction CopyButton({ text, label = \"คัดลอก\", size = \"md\", variant = \"default\" }: {\r\n  text: string;\r\n  label?: string;\r\n  size?: \"sm\" | \"md\";\r\n  variant?: \"default\" | \"primary\";\r\n}) {\r\n  const disabled = !text || text.trim().length === 0;\r\n  \r\n  const baseClasses = `\r\n    inline-flex items-center gap-1 ${size === \"sm\" ? \"px-3 py-1.5 text-sm\" : \"px-4 py-2 text-base\"}\r\n    rounded-lg font-medium transition-all duration-200\r\n    ${disabled ? \"opacity-50 cursor-not-allowed\" : \"hover:scale-[1.02] active:scale-[0.98]\"}\r\n  `;\r\n  \r\n  const variantClasses = variant === \"primary\" \r\n    ? \"bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 shadow-sm\"\r\n    : \"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 hover:border-gray-400\";\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      disabled={disabled}\r\n      onClick={async () => await copyToClipboard(text)}\r\n      className={`${baseClasses} ${variantClasses}`}\r\n    >\r\n      <ClipboardIcon className=\"h-4 w-4\" />\r\n      {label}\r\n    </button>\r\n  );\r\n}\r\n\r\n/* ================= TEXT DIFF HELPERS ================= */\r\n\r\nfunction getHighlightedText(oldText: string, newText: string) {\r\n  if (!oldText || !newText) return { oldHighlighted: oldText, newHighlighted: newText };\r\n  \r\n  const oldWords = oldText.split(/(\\s+)/);\r\n  const newWords = newText.split(/(\\s+)/);\r\n  \r\n  const oldWordSet = new Set(oldWords.filter(w => w.trim().length > 0));\r\n  const newWordSet = new Set(newWords.filter(w => w.trim().length > 0));\r\n  \r\n  const oldHighlighted = oldWords.map((word, index) => {\r\n    if (!newWordSet.has(word) && word.trim().length > 0) {\r\n      return `<span class=\"bg-red-200 text-red-900 px-1 py-0.5 rounded border border-red-300 font-medium\">${word}</span>`;\r\n    }\r\n    return word;\r\n  }).join('');\r\n  \r\n  const newHighlighted = newWords.map((word, index) => {\r\n    if (!oldWordSet.has(word) && word.trim().length > 0) {\r\n      return `<span class=\"bg-emerald-200 text-emerald-900 px-1 py-0.5 rounded border border-emerald-300 font-medium\">${word}</span>`;\r\n    }\r\n    return word;\r\n  }).join('');\r\n  \r\n  return { oldHighlighted, newHighlighted };\r\n}\r\n\r\n/* ================= DIFF VIEW COMPONENT ================= */\r\n\r\nfunction DiffView({ oldText, newText }: { oldText: string; newText: string }) {\r\n  const { oldHighlighted, newHighlighted } = getHighlightedText(oldText, newText);\r\n  \r\n  const formattedOldText = oldText ? oldText.split('\\n').map((line, index) => {\r\n    if (!line.trim()) return <div key={index} className=\"h-4\"></div>;\r\n    \r\n    const words = line.split(/(\\s+)/);\r\n    const newWords = newText ? newText.split(/(\\s+)/).filter(w => w.trim().length > 0) : [];\r\n    const newWordSet = new Set(newWords);\r\n    \r\n    return (\r\n      <div key={index} className=\"mb-2 last:mb-0\">\r\n        {words.map((word, wordIndex) => {\r\n          if (!newWordSet.has(word) && word.trim().length > 0) {\r\n            return (\r\n              <span\r\n                key={wordIndex}\r\n                className=\"bg-red-200 text-red-900 px-1 py-0.5 rounded border border-red-300 font-medium mx-0.5\"\r\n              >\r\n                {word}\r\n              </span>\r\n            );\r\n          }\r\n          return word;\r\n        })}\r\n      </div>\r\n    );\r\n  }) : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>;\r\n\r\n  const formattedNewText = newText ? newText.split('\\n').map((line, index) => {\r\n    if (!line.trim()) return <div key={index} className=\"h-4\"></div>;\r\n    \r\n    const words = line.split(/(\\s+)/);\r\n    const oldWords = oldText ? oldText.split(/(\\s+)/).filter(w => w.trim().length > 0) : [];\r\n    const oldWordSet = new Set(oldWords);\r\n    \r\n    return (\r\n      <div key={index} className=\"mb-2 last:mb-0\">\r\n        {words.map((word, wordIndex) => {\r\n          if (!oldWordSet.has(word) && word.trim().length > 0) {\r\n            return (\r\n              <span\r\n                key={wordIndex}\r\n                className=\"bg-emerald-200 text-emerald-900 px-1 py-0.5 rounded border border-emerald-300 font-medium mx-0.5\"\r\n              >\r\n                {word}\r\n              </span>\r\n            );\r\n          }\r\n          return word;\r\n        })}\r\n      </div>\r\n    );\r\n  }) : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>;\r\n\r\n  return (\r\n    <div className=\"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm\">\r\n      <div className=\"grid grid-cols-2 divide-x divide-gray-200\">\r\n        {/* Old Version */}\r\n        <div className=\"p-4 bg-gradient-to-b from-red-50/20 to-white\">\r\n          <div className=\"flex items-center gap-2 mb-3\">\r\n            <div className=\"h-3 w-3 bg-red-500 rounded-full shadow-sm\"></div>\r\n            <div className=\"text-sm font-bold text-red-700 bg-red-100 px-3 py-1 rounded-full\">OLD VERSION</div>\r\n          </div>\r\n          <div className=\"text-base leading-relaxed text-gray-800 bg-white/50 p-3 rounded-lg border border-red-100 min-h-[200px]\">\r\n            <div className=\"whitespace-pre-wrap\">\r\n              {formattedOldText}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* New Version */}\r\n        <div className=\"p-4 bg-gradient-to-b from-emerald-50/20 to-white\">\r\n          <div className=\"flex items-center gap-2 mb-3\">\r\n            <div className=\"h-3 w-3 bg-emerald-500 rounded-full shadow-sm\"></div>\r\n            <div className=\"text-sm font-bold text-emerald-700 bg-emerald-100 px-3 py-1 rounded-full\">NEW VERSION</div>\r\n          </div>\r\n          <div className=\"text-base leading-relaxed text-gray-800 bg-white/50 p-3 rounded-lg border border-emerald-100 min-h-[200px]\">\r\n            <div className=\"whitespace-pre-wrap\">\r\n              {formattedNewText}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ================= FULLSCREEN DIFF COMPONENT ================= */\r\n\r\nfunction FullscreenDiffViewer({ detail, onClose }: { detail: ComparisonDetail; onClose: () => void }) {\r\n  const [currentChangeIndex, setCurrentChangeIndex] = useState(0);\r\n  const changes = detail.changes;\r\n  const currentChange = changes[currentChangeIndex];\r\n\r\n  const handlePrev = () => {\r\n    setCurrentChangeIndex(prev => Math.max(0, prev - 1));\r\n  };\r\n\r\n  const handleNext = () => {\r\n    setCurrentChangeIndex(prev => Math.min(changes.length - 1, prev + 1));\r\n  };\r\n\r\n  const handleKeyDown = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') onClose();\r\n    if (e.key === 'ArrowLeft') handlePrev();\r\n    if (e.key === 'ArrowRight') handleNext();\r\n  };\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, []);\r\n\r\n  const getHighlightedOldText = () => {\r\n    const oldText = currentChange.old_text || '';\r\n    const newText = currentChange.new_text || '';\r\n    \r\n    const oldWords = oldText.split(/(\\s+)/);\r\n    const newWords = newText.split(/(\\s+)/).filter(w => w.trim().length > 0);\r\n    const newWordSet = new Set(newWords);\r\n    \r\n    const lines = oldText.split('\\n');\r\n    \r\n    return lines.map((line, lineIndex) => {\r\n      if (!line.trim()) return <div key={lineIndex} className=\"h-4\"></div>;\r\n      \r\n      const words = line.split(/(\\s+)/);\r\n      \r\n      return (\r\n        <div key={lineIndex} className=\"mb-2 last:mb-0\">\r\n          {words.map((word, wordIndex) => {\r\n            if (!newWordSet.has(word) && word.trim().length > 0) {\r\n              return (\r\n                <span\r\n                  key={`${lineIndex}-${wordIndex}`}\r\n                  className=\"bg-red-200 text-red-900 px-1 py-0.5 rounded border border-red-300 font-medium mx-0.5\"\r\n                >\r\n                  {word}\r\n                </span>\r\n              );\r\n            }\r\n            return word;\r\n          })}\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  const getHighlightedNewText = () => {\r\n    const oldText = currentChange.old_text || '';\r\n    const newText = currentChange.new_text || '';\r\n    \r\n    const oldWords = oldText.split(/(\\s+)/).filter(w => w.trim().length > 0);\r\n    const newWords = newText.split(/(\\s+)/);\r\n    const oldWordSet = new Set(oldWords);\r\n    \r\n    const lines = newText.split('\\n');\r\n    \r\n    return lines.map((line, lineIndex) => {\r\n      if (!line.trim()) return <div key={lineIndex} className=\"h-4\"></div>;\r\n      \r\n      const words = line.split(/(\\s+)/);\r\n      \r\n      return (\r\n        <div key={lineIndex} className=\"mb-2 last:mb-0\">\r\n          {words.map((word, wordIndex) => {\r\n            if (!oldWordSet.has(word) && word.trim().length > 0) {\r\n              return (\r\n                <span\r\n                  key={`${lineIndex}-${wordIndex}`}\r\n                  className=\"bg-emerald-200 text-emerald-900 px-1 py-0.5 rounded border border-emerald-300 font-medium mx-0.5\"\r\n                >\r\n                  {word}\r\n                </span>\r\n              );\r\n            }\r\n            return word;\r\n          })}\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  const highlightedOldText = getHighlightedOldText();\r\n  const highlightedNewText = getHighlightedNewText();\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 bg-white flex flex-col\">\r\n      {/* Minimal Header */}\r\n      <div className=\"absolute top-0 left-0 right-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-200\">\r\n        <div className=\"max-w-full px-4 py-3 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              title=\"ปิด (ESC)\"\r\n            >\r\n              <XMarkIcon className=\"h-5 w-5 text-gray-600\" />\r\n            </button>\r\n            <div>\r\n              <h2 className=\"font-semibold text-gray-900 line-clamp-1\">{detail.document_name}</h2>\r\n              <div className=\"flex items-center gap-2 text-xs text-gray-500\">\r\n                <span className=\"font-medium text-blue-600\">{detail.version_old_label}</span>\r\n                <span>→</span>\r\n                <span className=\"font-medium text-emerald-600\">{detail.version_new_label}</span>\r\n                <span className=\"mx-1\">•</span>\r\n                <span>Change {currentChangeIndex + 1} of {changes.length}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              onClick={handlePrev}\r\n              disabled={currentChangeIndex === 0}\r\n              className=\"p-2 disabled:opacity-30 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              title=\"ก่อนหน้า (←)\"\r\n            >\r\n              <ChevronLeftIcon className=\"h-5 w-5 text-gray-600\" />\r\n            </button>\r\n            \r\n            <div className=\"min-w-[80px] text-center text-sm font-medium text-gray-700\">\r\n              {currentChangeIndex + 1}/{changes.length}\r\n            </div>\r\n            \r\n            <button\r\n              onClick={handleNext}\r\n              disabled={currentChangeIndex === changes.length - 1}\r\n              className=\"p-2 disabled:opacity-30 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              title=\"ถัดไป (→)\"\r\n            >\r\n              <ChevronRightIcon className=\"h-5 w-5 text-gray-600\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content - True Fullscreen */}\r\n      <div className=\"flex-1 grid grid-cols-2 pt-12 overflow-hidden\">\r\n        {/* Old Version Panel */}\r\n        <div className=\"h-full overflow-auto p-8 bg-gradient-to-b from-red-50/20 to-white\">\r\n          <div className=\"max-w-4xl mx-auto\">\r\n            <div className=\"mb-6\">\r\n              <div className=\"flex items-center gap-3 mb-2\">\r\n                <div className=\"h-4 w-4 bg-red-500 rounded-full\"></div>\r\n                <h3 className=\"text-lg font-bold text-red-700\">OLD VERSION</h3>\r\n                <span className=\"ml-auto text-sm font-medium bg-red-100 text-red-700 px-3 py-1 rounded-full\">\r\n                  {detail.version_old_label}\r\n                </span>\r\n              </div>\r\n              <p className=\"text-sm text-gray-500\">ข้อความที่ถูกลบหรือเปลี่ยนแปลงจะถูกไฮไลท์ด้วยสีแดง</p>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-xl p-6 border border-red-100 shadow-sm\">\r\n              <div className=\"text-gray-800 leading-relaxed text-base whitespace-pre-wrap\">\r\n                {currentChange.old_text ? highlightedOldText : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* New Version Panel */}\r\n        <div className=\"h-full overflow-auto p-8 bg-gradient-to-b from-emerald-50/20 to-white border-l border-gray-200\">\r\n          <div className=\"max-w-4xl mx-auto\">\r\n            <div className=\"mb-6\">\r\n              <div className=\"flex items-center gap-3 mb-2\">\r\n                <div className=\"h-4 w-4 bg-emerald-500 rounded-full\"></div>\r\n                <h3 className=\"text-lg font-bold text-emerald-700\">NEW VERSION</h3>\r\n                <span className=\"ml-auto text-sm font-medium bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full\">\r\n                  {detail.version_new_label}\r\n                </span>\r\n              </div>\r\n              <p className=\"text-sm text-gray-500\">ข้อความที่เพิ่มหรือเปลี่ยนแปลงจะถูกไฮไลท์ด้วยสีเขียว</p>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-xl p-6 border border-emerald-100 shadow-sm\">\r\n              <div className=\"text-gray-800 leading-relaxed text-base whitespace-pre-wrap\">\r\n                {currentChange.new_text ? highlightedNewText : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Minimal Footer with Info */}\r\n      <div className=\"absolute bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-gray-200\">\r\n        <div className=\"max-w-full px-4 py-2 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4 text-sm text-gray-600\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"font-medium\">Section:</span>\r\n              <span className=\"font-semibold\">{currentChange.section_label || \"No Section\"}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"font-medium\">Type:</span>\r\n              {changeTypeBadge(currentChange.change_type)}\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"font-medium\">Risk:</span>\r\n              {riskBadge(currentChange.risk_level)}\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"text-xs text-gray-500\">\r\n            Press <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-300\">ESC</kbd> to close • \r\n            <kbd className=\"mx-1 px-1.5 py-0.5 bg-gray-100 rounded border border-gray-300\">←</kbd>\r\n            <kbd className=\"ml-1 px-1.5 py-0.5 bg-gray-100 rounded border border-gray-300\">→</kbd> to navigate\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ExpandableText({ text, title, maxLength = 300, type = \"normal\" }: { \r\n  text: string | null | undefined; \r\n  title?: string;\r\n  maxLength?: number;\r\n  type?: \"normal\" | \"ai\";\r\n}) {\r\n  const raw = normalizeText(text);\r\n  const [expanded, setExpanded] = useState(false);\r\n  const isLong = raw.length > maxLength;\r\n  const shown = expanded ? raw : raw.slice(0, maxLength) + (isLong ? \"...\" : \"\");\r\n\r\n  const bgColor = type === \"ai\" ? \"bg-gradient-to-br from-blue-50/80 to-blue-100/50\" : \"bg-gray-50\";\r\n  \r\n  const formattedText = shown ? shown.split('\\n').map((line, index) => (\r\n    <div key={index} className=\"mb-2 last:mb-0\">\r\n      {line}\r\n    </div>\r\n  )) : <span className=\"text-gray-400 italic\">ไม่มีข้อมูล</span>;\r\n\r\n  return (\r\n    <div className={`rounded-xl p-4 ${bgColor} border ${type === \"ai\" ? \"border-blue-200\" : \"border-gray-200\"}`}>\r\n      {title && (\r\n        <div className=\"flex items-center gap-2 mb-3\">\r\n          <span className=\"text-base font-bold text-gray-900\">{title}</span>\r\n        </div>\r\n      )}\r\n      <div className=\"text-base text-gray-800 whitespace-pre-wrap leading-relaxed font-normal\">\r\n        {formattedText}\r\n      </div>\r\n      {isLong && (\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setExpanded(!expanded)}\r\n          className=\"mt-3 px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-800 bg-white border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors\"\r\n        >\r\n          {expanded ? \"ย่อข้อความ\" : \"อ่านต่อ...\"}\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ================= AI CHAT COMPONENT ================= */\r\n\r\nfunction AIChat({ change }: { change: ChangeItem }) {\r\n\r\n  const [chatOpen, setChatOpen] = useState(false)\r\n\r\n  const [messages, setMessages] = useState<\r\n    { role: \"user\" | \"assistant\", content: string }[]\r\n  >([])\r\n\r\n  const [input, setInput] = useState(\"\")\r\n  const [loading, setLoading] = useState(false)\r\n  const [chatError, setChatError] = useState<string | null>(null)\r\n\r\n  const bottomRef = useRef<HTMLDivElement>(null)\r\n\r\n  useEffect(() => {\r\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" })\r\n  }, [messages])\r\n\r\n\r\n  const sendChat = async () => {\r\n\r\n    const question = input.trim()\r\n    if (!question) return\r\n\r\n    setInput(\"\")\r\n    setLoading(true)\r\n    setChatError(null)\r\n\r\n    // user bubble\r\n    setMessages(prev => [...prev, { role: \"user\", content: question }])\r\n\r\n    // ai bubble placeholder\r\n    setMessages(prev => [...prev, { role: \"assistant\", content: \"\" }])\r\n\r\n    try {\r\n      const res = await fetch(`${API_BASE_CHAT}/changes/${change.id}/chat`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ question }),\r\n      })\r\n\r\n      if (!res.ok) throw new Error(`Chat failed (${res.status})`)\r\n\r\n      const data = await res.json()\r\n      const answer = normalizeText(data?.answer) || \"\"\r\n\r\n      setMessages(prev => {\r\n        const copy = [...prev]\r\n        copy[copy.length - 1].content = answer\r\n        return copy\r\n      })\r\n\r\n    } catch (e: any) {\r\n\r\n      setChatError(e?.message || \"ส่งคำถามไม่สำเร็จ\")\r\n\r\n      setMessages(prev => {\r\n        const copy = [...prev]\r\n        copy[copy.length - 1].content = \"❌ เกิดข้อผิดพลาด\"\r\n        return copy\r\n      })\r\n\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n\r\n      {/* ================= AI COMMENT + SUGGESTION (เหมือนเดิม) ================= */}\r\n      <div className=\"grid md:grid-cols-2 gap-4\">\r\n\r\n        <div className=\"rounded-xl overflow-hidden border border-blue-200 bg-gradient-to-br from-blue-50/80 to-white shadow-sm\">\r\n          <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <InformationCircleIcon className=\"h-5 w-5 text-white\" />\r\n                <h3 className=\"text-base font-bold text-white\">ความคิดเห็นจาก AI</h3>\r\n              </div>\r\n              <CopyButton text={normalizeText(change.ai_comment)} size=\"sm\" variant=\"primary\" />\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4\">\r\n            <ExpandableText text={change.ai_comment} type=\"ai\" />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"rounded-xl overflow-hidden border border-amber-200 bg-gradient-to-br from-amber-50/80 to-white shadow-sm\">\r\n          <div className=\"bg-gradient-to-r from-amber-600 to-amber-700 px-4 py-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <LightBulbIcon className=\"h-5 w-5 text-white\" />\r\n                <h3 className=\"text-base font-bold text-white\">คำแนะนำจาก AI</h3>\r\n              </div>\r\n              <CopyButton text={normalizeText(change.ai_suggestion)} size=\"sm\" variant=\"primary\" />\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4\">\r\n            <ExpandableText text={change.ai_suggestion} type=\"ai\" />\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n      {/* ================= CHAT BUBBLE ================= */}\r\n      <div className=\"rounded-xl border border-purple-200 overflow-hidden bg-gradient-to-br from-purple-50/30 to-white shadow-sm\">\r\n\r\n        <button\r\n          onClick={() => setChatOpen(!chatOpen)}\r\n          className=\"w-full px-4 py-3 bg-gradient-to-r from-purple-600 to-purple-700 flex items-center justify-between\"\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            <ChatBubbleLeftRightIcon className=\"h-5 w-5 text-white\" />\r\n            <span className=\"text-base font-bold text-white\">\r\n              ถาม AI เพิ่มเติมเกี่ยวกับจุดนี้\r\n            </span>\r\n          </div>\r\n          <span className=\"text-white font-bold\">{chatOpen ? \"▲\" : \"▼\"}</span>\r\n        </button>\r\n\r\n\r\n        {chatOpen && (\r\n          <div className=\"flex flex-col h-[420px]\">\r\n\r\n            {/* chat messages */}\r\n            <div className=\"flex-1 overflow-auto p-4 space-y-3 bg-gray-50\">\r\n\r\n              {messages.map((m, i) => (\r\n                <div\r\n                  key={i}\r\n                  className={`flex ${m.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\r\n                >\r\n                  <div\r\n                    className={`\r\n                      px-4 py-2 rounded-2xl max-w-[75%]\r\n                      whitespace-pre-wrap text-sm shadow\r\n                      ${m.role === \"user\"\r\n                        ? \"bg-blue-600 text-white\"\r\n                        : \"bg-white border border-gray-200\"}\r\n                    `}\r\n                  >\r\n                    {m.content || (loading && m.role === \"assistant\" ? \"กำลังคิด...\" : \"\")}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n\r\n              <div ref={bottomRef} />\r\n\r\n            </div>\r\n\r\n\r\n            {/* error */}\r\n            {chatError && (\r\n              <div className=\"px-4 pb-2 text-sm text-red-600\">\r\n                {chatError}\r\n              </div>\r\n            )}\r\n\r\n\r\n            {/* input */}\r\n            <div className=\"border-t p-3 flex gap-2 bg-white\">\r\n\r\n              <input\r\n                value={input}\r\n                onChange={e => setInput(e.target.value)}\r\n                placeholder=\"พิมพ์คำถาม...\"\r\n                className=\"flex-1 border rounded-lg px-3 py-2 text-sm\"\r\n                onKeyDown={e => {\r\n                  if (e.key === \"Enter\") sendChat()\r\n                }}\r\n              />\r\n\r\n              <button\r\n                onClick={sendChat}\r\n                disabled={loading}\r\n                className=\"bg-blue-600 text-white px-4 rounded-lg text-sm font-medium\"\r\n              >\r\n                ส่ง\r\n              </button>\r\n\r\n            </div>\r\n\r\n          </div>\r\n        )}\r\n\r\n      </div>\r\n\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n/* ================= MAIN PAGE ================= */\r\n\r\nexport default function CompareReportPage() {\r\n  const { id } = useParams<{ id: string }>();\r\n  const [detail, setDetail] = useState<ComparisonDetail | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [riskFilter, setRiskFilter] = useState<\"ALL\" | RiskLevel>(\"ALL\");\r\n  const [typeFilter, setTypeFilter] = useState<\"ALL\" | ChangeType>(\"ALL\");\r\n  const [annotating, setAnnotating] = useState(false);\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [showFullscreen, setShowFullscreen] = useState(false);\r\n  const [fullscreenChangeIndex, setFullscreenChangeIndex] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (id) loadDetail();\r\n  }, [id]);\r\n\r\n  const loadDetail = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comparisons/${id}`, { cache: \"no-store\" });\r\n      if (!res.ok) throw new Error(`Failed to load (${res.status})`);\r\n      const data: ComparisonDetail = await res.json();\r\n      setDetail(data);\r\n    } catch (err: any) {\r\n      setError(err?.message || \"โหลดข้อมูลไม่สำเร็จ\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAnnotate = async () => {\r\n    if (!id) return;\r\n    setAnnotating(true);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comparisons/${id}/annotate`, { method: \"POST\" });\r\n      if (!res.ok) throw new Error(`Annotation failed (${res.status})`);\r\n      await loadDetail();\r\n    } catch (err: any) {\r\n      console.error(\"Annotation error:\", err);\r\n    } finally {\r\n      setAnnotating(false);\r\n    }\r\n  };\r\n\r\n  const handleOpenFullscreen = (index: number) => {\r\n    setFullscreenChangeIndex(index);\r\n    setShowFullscreen(true);\r\n  };\r\n\r\n  const filteredChanges = useMemo(() => {\r\n    const changes = detail?.changes || [];\r\n    const query = searchQuery.trim();\r\n\r\n    return changes.filter(c => {\r\n      if (riskFilter !== \"ALL\") {\r\n        const lv = (c.risk_level || \"LOW\").toUpperCase();\r\n        if (lv !== riskFilter) return false;\r\n      }\r\n\r\n      if (typeFilter !== \"ALL\") {\r\n        if (c.change_type !== typeFilter) return false;\r\n      }\r\n\r\n      if (query.length > 0) {\r\n        const hay = [\r\n          c.section_label,\r\n          c.old_text,\r\n          c.new_text,\r\n          c.ai_comment,\r\n          c.ai_suggestion,\r\n          c.risk_reason,\r\n          c.change_type,\r\n          c.risk_level,\r\n        ]\r\n          .map(x => normalizeText(x as any))\r\n          .join(\" | \");\r\n\r\n        if (!contains(hay, query)) return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }, [detail?.changes, searchQuery, riskFilter, typeFilter]);\r\n\r\n  const riskSummary = useMemo(() => {\r\n    const changes = detail?.changes || [];\r\n    return {\r\n      HIGH: changes.filter(c => c.risk_level === \"HIGH\").length,\r\n      MEDIUM: changes.filter(c => c.risk_level === \"MEDIUM\").length,\r\n      LOW: changes.filter(c => c.risk_level === \"LOW\").length,\r\n      TOTAL: changes.length,\r\n    };\r\n  }, [detail?.changes]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <ArrowPathIcon className=\"h-12 w-12 animate-spin text-blue-600 mx-auto\" />\r\n          <p className=\"mt-4 text-lg text-gray-700 font-medium\">กำลังโหลดรายงาน...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !detail) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center p-6\">\r\n        <div className=\"bg-white border border-red-200 rounded-xl p-8 max-w-md shadow-sm\">\r\n          <ExclamationTriangleIcon className=\"h-12 w-12 text-red-500 mx-auto\" />\r\n          <h2 className=\"text-xl font-bold text-gray-900 mt-4 text-center\">ไม่พบรายงาน</h2>\r\n          <p className=\"text-gray-600 mt-2 text-center\">{error || \"ไม่พบข้อมูลการเปรียบเทียบนี้\"}</p>\r\n          <button\r\n            onClick={loadDetail}\r\n            className=\"mt-6 w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-sm\"\r\n          >\r\n            โหลดใหม่\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const formattedSummaryText = detail.summary_text ? detail.summary_text.split('\\n').map((line, index) => (\r\n    <div key={index} className=\"mb-3 last:mb-0\">\r\n      {line}\r\n    </div>\r\n  )) : null;\r\n\r\n  return (\r\n    <>\r\n      {showFullscreen && detail && (\r\n        <FullscreenDiffViewer \r\n          detail={detail} \r\n          onClose={() => setShowFullscreen(false)} \r\n        />\r\n      )}\r\n      \r\n      <div className=\"min-h-screen bg-gradient-to-b from-gray-50/50 to-gray-100 p-4 md:p-6\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          {/* Header */}\r\n          <div className=\"mb-8\">\r\n            <div className=\"bg-white rounded-2xl border border-gray-200 shadow-sm p-6\">\r\n              <div className=\"flex flex-col lg:flex-row lg:items-start justify-between gap-6\">\r\n                <div className=\"flex-1\">\r\n                  <h1 className=\"text-2xl lg:text-3xl font-bold text-gray-900 mb-3\">\r\n                    {detail.document_name}\r\n                  </h1>\r\n                  <div className=\"flex flex-wrap items-center gap-3 text-gray-700 mb-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm rounded-lg font-semibold shadow-sm\">\r\n                        {detail.version_old_label}\r\n                      </span>\r\n                      <span className=\"text-gray-500\">→</span>\r\n                      <span className=\"px-3 py-1.5 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm rounded-lg font-semibold shadow-sm\">\r\n                        {detail.version_new_label}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <span className=\"text-gray-500\">•</span>\r\n                      {formatDateTime(detail.created_at)}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <span className=\"text-gray-500\">•</span>\r\n                      <span>ID: {detail.id}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col items-start lg:items-end gap-4\">\r\n                  <div className=\"text-right\">\r\n                    <div className=\"text-sm text-gray-600 font-medium mb-1\">ความเสี่ยงรวม</div>\r\n                    <div className={`text-2xl font-bold ${\r\n                      detail.overall_risk_level?.includes(\"HIGH\") ? \"text-red-600\" :\r\n                      detail.overall_risk_level?.includes(\"MEDIUM\") ? \"text-amber-600\" :\r\n                      \"text-emerald-600\"\r\n                    }`}>\r\n                      {detail.overall_risk_level || \"ไม่ระบุ\"}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex flex-col sm:flex-row gap-2\">\r\n                    <Link\r\n                      href={`/reports/generate?comparisonId=${detail.id}`}\r\n                      className=\"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 font-medium shadow-sm\"\r\n                    >\r\n                      <DocumentArrowDownIcon className=\"h-4 w-4\" />\r\n                      สร้างรายงาน\r\n                    </Link>\r\n                    \r\n                    <button\r\n                      onClick={handleAnnotate}\r\n                      disabled={annotating}\r\n                      className=\"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg hover:from-purple-700 hover:to-purple-800 disabled:opacity-70 font-medium shadow-sm\"\r\n                    >\r\n                      {annotating ? (\r\n                        <ArrowPathIcon className=\"h-4 w-4 animate-spin\" />\r\n                      ) : (\r\n                        <SparklesIcon className=\"h-4 w-4\" />\r\n                      )}\r\n                      {annotating ? \"กำลังวิเคราะห์...\" : \"AI วิเคราะห์ใหม่\"}\r\n                    </button>\r\n                    \r\n                    <button\r\n                      onClick={() => setShowFilters(!showFilters)}\r\n                      className=\"flex items-center gap-2 px-4 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium shadow-sm\"\r\n                    >\r\n                      <AdjustmentsHorizontalIcon className=\"h-4 w-4\" />\r\n                      ฟิลเตอร์\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Risk Summary */}\r\n              <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                  <div className=\"bg-gradient-to-br from-red-50 to-white border border-red-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-red-700\">{riskSummary.HIGH}</div>\r\n                    <div className=\"text-sm font-medium text-red-600\">HIGH RISK</div>\r\n                  </div>\r\n                  <div className=\"bg-gradient-to-br from-amber-50 to-white border border-amber-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-amber-700\">{riskSummary.MEDIUM}</div>\r\n                    <div className=\"text-sm font-medium text-amber-600\">MEDIUM RISK</div>\r\n                  </div>\r\n                  <div className=\"bg-gradient-to-br from-emerald-50 to-white border border-emerald-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-emerald-700\">{riskSummary.LOW}</div>\r\n                    <div className=\"text-sm font-medium text-emerald-600\">LOW RISK</div>\r\n                  </div>\r\n                  <div className=\"bg-gradient-to-br from-blue-50 to-white border border-blue-200 rounded-xl p-4 shadow-sm\">\r\n                    <div className=\"text-2xl font-bold text-blue-700\">{riskSummary.TOTAL}</div>\r\n                    <div className=\"text-sm font-medium text-blue-600\">TOTAL CHANGES</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* AI Summary */}\r\n            {detail.summary_text && (\r\n              <div className=\"mt-6 bg-gradient-to-br from-blue-50/80 to-white rounded-2xl border border-blue-200 shadow-sm p-6\">\r\n                <div className=\"flex items-center gap-3 mb-4\">\r\n                  <DocumentMagnifyingGlassIcon className=\"h-6 w-6 text-blue-600\" />\r\n                  <h2 className=\"text-xl font-bold text-gray-900\">สรุปผลการวิเคราะห์</h2>\r\n                </div>\r\n                <div className=\"text-base text-gray-800 leading-relaxed bg-white/50 border border-blue-100 rounded-xl p-4\">\r\n                  {formattedSummaryText}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Filters */}\r\n          {showFilters && (\r\n            <div className=\"mb-6 bg-white rounded-2xl border border-gray-200 shadow-sm p-6\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <FunnelIcon className=\"h-5 w-5 text-gray-700\" />\r\n                  <h3 className=\"font-bold text-gray-900\">ค้นหาและกรองข้อมูล</h3>\r\n                </div>\r\n                <button\r\n                  onClick={() => setShowFilters(false)}\r\n                  className=\"text-sm text-gray-600 hover:text-gray-900\"\r\n                >\r\n                  ปิด\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">ค้นหาคำ</label>\r\n                  <div className=\"relative\">\r\n                    <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2\" />\r\n                    <input\r\n                      value={searchQuery}\r\n                      onChange={(e) => setSearchQuery(e.target.value)}\r\n                      placeholder=\"ค้นหาคำในรายการเปลี่ยนแปลง...\"\r\n                      className=\"w-full pl-10 pr-3 py-3 text-base border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">กรองความเสี่ยง</label>\r\n                    <select\r\n                      value={riskFilter}\r\n                      onChange={(e) => setRiskFilter(e.target.value as any)}\r\n                      className=\"w-full px-3 py-3 text-base border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    >\r\n                      <option value=\"ALL\">ความเสี่ยงทั้งหมด</option>\r\n                      <option value=\"HIGH\">HIGH</option>\r\n                      <option value=\"MEDIUM\">MEDIUM</option>\r\n                      <option value=\"LOW\">LOW</option>\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">กรองประเภท</label>\r\n                    <select\r\n                      value={typeFilter}\r\n                      onChange={(e) => setTypeFilter(e.target.value as any)}\r\n                      className=\"w-full px-3 py-3 text-base border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    >\r\n                      <option value=\"ALL\">ประเภททั้งหมด</option>\r\n                      <option value=\"ADDED\">ADDED</option>\r\n                      <option value=\"REMOVED\">REMOVED</option>\r\n                      <option value=\"MODIFIED\">MODIFIED</option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"mt-4 text-sm text-gray-600\">\r\n                แสดง {filteredChanges.length} จาก {detail.changes.length} รายการ\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Changes List */}\r\n          <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h2 className=\"text-xl font-bold text-gray-900\">รายการเปลี่ยนแปลง</h2>\r\n              <div className=\"text-sm text-gray-600\">\r\n                {filteredChanges.length} รายการ\r\n              </div>\r\n            </div>\r\n\r\n            {filteredChanges.length === 0 ? (\r\n              <div className=\"bg-white rounded-2xl border border-gray-200 p-8 text-center shadow-sm\">\r\n                <p className=\"text-lg text-gray-500\">ไม่พบรายการเปลี่ยนแปลงตามเงื่อนไขที่เลือก</p>\r\n              </div>\r\n            ) : (\r\n              filteredChanges.map((change, index) => (\r\n                <div key={change.id} className=\"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                  {/* Header */}\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-white border-b border-gray-200 p-5\">\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-3\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {changeTypeBadge(change.change_type)}\r\n                        <h3 className=\"text-lg font-bold text-gray-900\">\r\n                          {change.section_label || \"ไม่มีหัวข้อ\"}\r\n                        </h3>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {riskBadge(change.risk_level)}\r\n                        <span className=\"text-sm text-gray-500\">ID: {change.id}</span>\r\n                        <button\r\n                          onClick={() => handleOpenFullscreen(index)}\r\n                          className=\"flex items-center gap-2 px-3 py-1.5 text-sm bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-sm\"\r\n                        >\r\n                          <ArrowsPointingOutIcon className=\"h-4 w-4\" />\r\n                          เปิดเต็มจอ\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Content */}\r\n                  <div className=\"p-5 space-y-6\">\r\n                    {/* Diff View with highlighted changes */}\r\n                    <div>\r\n                      <h4 className=\"text-base font-bold text-gray-800 mb-3\">การเปลี่ยนแปลงข้อความ</h4>\r\n                      <DiffView\r\n                        oldText={normalizeText(change.old_text)}\r\n                        newText={normalizeText(change.new_text)}\r\n                      />\r\n                    </div>\r\n\r\n                    {/* AI Analysis Section */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-3 mb-4\">\r\n                        <div className=\"h-8 w-1 bg-gradient-to-b from-purple-500 to-purple-600 rounded-full\"></div>\r\n                        <h4 className=\"text-lg font-bold text-gray-900\">การวิเคราะห์ด้วย AI</h4>\r\n                      </div>\r\n                      <AIChat change={change} />\r\n                    </div>\r\n\r\n                    {/* Quick Copy */}\r\n                    <div className=\"border-t border-gray-200 pt-4\">\r\n                      <CopyButton\r\n                        text={`[${change.section_label || \"-\"}]\\n` +\r\n                          `ประเภท: ${change.change_type} | ความเสี่ยง: ${change.risk_level}\\n\\n` +\r\n                          `OLD:\\n${change.old_text || \"-\"}\\n\\n` +\r\n                          `NEW:\\n${change.new_text || \"-\"}\\n\\n` +\r\n                          `AI COMMENT:\\n${change.ai_comment || \"-\"}\\n\\n` +\r\n                          `AI SUGGESTION:\\n${change.ai_suggestion || \"-\"}`\r\n                        }\r\n                        label=\"คัดลอกข้อมูลทั้งหมด\"\r\n                        variant=\"primary\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}