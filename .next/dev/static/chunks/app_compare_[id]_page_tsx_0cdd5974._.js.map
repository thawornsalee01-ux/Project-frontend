{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/app/compare/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useRef } from \"react\"\r\n\r\nimport { useParams } from \"next/navigation\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport {\r\n  ArrowPathIcon,\r\n  ExclamationTriangleIcon,\r\n  DocumentMagnifyingGlassIcon,\r\n  LightBulbIcon,\r\n  ChatBubbleLeftRightIcon,\r\n  MagnifyingGlassIcon,\r\n  FunnelIcon,\r\n  InformationCircleIcon,\r\n  AdjustmentsHorizontalIcon,\r\n  ArrowsPointingOutIcon,\r\n  ArrowsPointingInIcon,\r\n  XMarkIcon,\r\n  ChevronLeftIcon,\r\n  ChevronRightIcon,\r\n} from \"@heroicons/react/24/outline\";\r\n\r\n/* ================= TYPES ================= */\r\n\r\ntype ChangeType = \"ADDED\" | \"REMOVED\" | \"MODIFIED\";\r\ntype RiskLevel = \"LOW\" | \"MEDIUM\" | \"HIGH\";\r\n\r\ntype ChangeItem = {\r\n  id: number;\r\n  change_type: ChangeType;\r\n  section_label: string | null;\r\n  old_text: string | null;\r\n  new_text: string | null;\r\n  risk_level?: RiskLevel | null;\r\n  ai_comment?: string | null;\r\n  ai_suggestion?: string | null;\r\n  risk_reason?: string | null;\r\n};\r\n\r\ntype ComparisonDetail = {\r\n  id: number;\r\n  document_name: string;\r\n  version_old_label: string;\r\n  version_new_label: string;\r\n  created_at: string;\r\n  overall_risk_level?: string | null;\r\n  summary_text?: string | null;\r\n  changes: ChangeItem[];\r\n};\r\n\r\ntype ChatState = {\r\n  open: boolean;\r\n  question: string;\r\n  loading: boolean;\r\n  answer: string;\r\n  error: string | null;\r\n};\r\n\r\nconst API_BASE = process.env.NEXT_PUBLIC_HISTORY_API ?? \"/api/history\";\r\nconst API_BASE_CHAT = process.env.NEXT_PUBLIC_HISTORY_CHAT_API ?? \"/api/chat\";\r\n\r\n\r\n/* ================= HELPERS ================= */\r\n\r\nfunction normalizeText(s?: string | null) {\r\n  return (s || \"\").toString().trim();\r\n}\r\n\r\nfunction contains(hay: string, needle: string) {\r\n  return hay.toLowerCase().includes(needle.toLowerCase());\r\n}\r\n\r\nfunction formatDateTime(iso: string) {\r\n  try {\r\n    return new Date(iso).toLocaleString(\"th-TH\", {\r\n      year: \"numeric\",\r\n      month: \"short\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    });\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction riskBadge(risk?: string | null) {\r\n  const base = \"px-3 py-1 rounded-md font-bold\";\r\n  const level = (risk || \"\").toUpperCase();\r\n\r\n  if (level === \"HIGH\")\r\n    return <span className={`${base} bg-gradient-to-r from-red-500 to-red-600 text-white text-sm shadow-sm`}>HIGH</span>;\r\n  if (level === \"MEDIUM\")\r\n    return <span className={`${base} bg-gradient-to-r from-amber-500 to-amber-600 text-white text-sm shadow-sm`}>MEDIUM</span>;\r\n  return null;\r\n}\r\n\r\nfunction changeTypeBadge(type: ChangeType) {\r\n  const base = \"px-3 py-1 rounded-md font-bold\";\r\n  if (type === \"ADDED\")\r\n    return <span className={`${base} bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm shadow-sm`}>ADDED</span>;\r\n  if (type === \"REMOVED\")\r\n    return <span className={`${base} bg-gradient-to-r from-red-500 to-red-600 text-white text-sm shadow-sm`}>REMOVED</span>;\r\n  return <span className={`${base} bg-gradient-to-r from-amber-500 to-amber-600 text-white text-sm shadow-sm`}>MODIFIED</span>;\r\n}\r\n\r\n/* ================= TEXT DIFF HELPERS ================= */\r\n\r\nfunction getHighlightedText(oldText: string, newText: string) {\r\n  if (!oldText || !newText) return { oldHighlighted: oldText, newHighlighted: newText };\r\n  \r\n  const oldWords = oldText.split(/(\\s+)/);\r\n  const newWords = newText.split(/(\\s+)/);\r\n  \r\n  const oldWordSet = new Set(oldWords.filter(w => w.trim().length > 0));\r\n  const newWordSet = new Set(newWords.filter(w => w.trim().length > 0));\r\n  \r\n  const oldHighlighted = oldWords.map((word, index) => {\r\n    if (!newWordSet.has(word) && word.trim().length > 0) {\r\n      return `<span class=\"bg-red-200 text-red-900 px-1 py-0.5 rounded border border-red-300 font-medium line-through decoration-red-700 decoration-2\">${word}</span>`;\r\n    }\r\n    return word;\r\n  }).join('');\r\n  \r\n  const newHighlighted = newWords.map((word, index) => {\r\n    if (!oldWordSet.has(word) && word.trim().length > 0) {\r\n      return `<span class=\"bg-emerald-200 text-emerald-900 px-1 py-0.5 rounded border border-emerald-300 font-medium\">${word}</span>`;\r\n    }\r\n    return word;\r\n  }).join('');\r\n  \r\n  return { oldHighlighted, newHighlighted };\r\n}\r\n\r\n/* ================= DIFF VIEW COMPONENT ================= */\r\n\r\nfunction DiffView({ oldText, newText }: { oldText: string; newText: string }) {\r\n  const { oldHighlighted, newHighlighted } = getHighlightedText(oldText, newText);\r\n  \r\n  const formattedOldText = oldText ? oldText.split('\\n').map((line, index) => {\r\n    if (!line.trim()) return <div key={index} className=\"h-4\"></div>;\r\n    \r\n    const words = line.split(/(\\s+)/);\r\n    const newWords = newText ? newText.split(/(\\s+)/).filter(w => w.trim().length > 0) : [];\r\n    const newWordSet = new Set(newWords);\r\n    \r\n    return (\r\n      <div key={index} className=\"mb-2 last:mb-0\">\r\n        {words.map((word, wordIndex) => {\r\n          if (!newWordSet.has(word) && word.trim().length > 0) {\r\n            return (\r\n              <span\r\n                key={wordIndex}\r\n                className=\"bg-red-200 text-red-900 px-1 py-0.5 rounded border border-red-300 font-medium line-through decoration-red-700 decoration-2 mx-0.5\"\r\n              >\r\n                {word}\r\n              </span>\r\n            );\r\n          }\r\n          return word;\r\n        })}\r\n      </div>\r\n    );\r\n  }) : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>;\r\n\r\n  const formattedNewText = newText ? newText.split('\\n').map((line, index) => {\r\n    if (!line.trim()) return <div key={index} className=\"h-4\"></div>;\r\n    \r\n    const words = line.split(/(\\s+)/);\r\n    const oldWords = oldText ? oldText.split(/(\\s+)/).filter(w => w.trim().length > 0) : [];\r\n    const oldWordSet = new Set(oldWords);\r\n    \r\n    return (\r\n      <div key={index} className=\"mb-2 last:mb-0\">\r\n        {words.map((word, wordIndex) => {\r\n          if (!oldWordSet.has(word) && word.trim().length > 0) {\r\n            return (\r\n              <span\r\n                key={wordIndex}\r\n                className=\"bg-emerald-200 text-emerald-900 px-1 py-0.5 rounded border border-emerald-300 font-medium mx-0.5\"\r\n              >\r\n                {word}\r\n              </span>\r\n            );\r\n          }\r\n          return word;\r\n        })}\r\n      </div>\r\n    );\r\n  }) : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>;\r\n\r\n  return (\r\n    <div className=\"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm\">\r\n      <div className=\"grid grid-cols-2 divide-x divide-gray-200\">\r\n        {/* Old Version */}\r\n        <div className=\"p-4 bg-gradient-to-b from-red-50/20 to-white\">\r\n          <div className=\"flex items-center gap-2 mb-3\">\r\n            <div className=\"h-3 w-3 bg-red-500 rounded-full shadow-sm\"></div>\r\n            <div className=\"text-sm font-bold text-red-700 bg-red-100 px-3 py-1 rounded-full\">OLD VERSION</div>\r\n          </div>\r\n          <div className=\"text-base leading-relaxed text-gray-800 bg-white/50 p-3 rounded-lg border border-red-100 min-h-[200px]\">\r\n            <div className=\"whitespace-pre-wrap\">\r\n              {formattedOldText}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* New Version */}\r\n        <div className=\"p-4 bg-gradient-to-b from-emerald-50/20 to-white\">\r\n          <div className=\"flex items-center gap-2 mb-3\">\r\n            <div className=\"h-3 w-3 bg-emerald-500 rounded-full shadow-sm\"></div>\r\n            <div className=\"text-sm font-bold text-emerald-700 bg-emerald-100 px-3 py-1 rounded-full\">NEW VERSION</div>\r\n          </div>\r\n          <div className=\"text-base leading-relaxed text-gray-800 bg-white/50 p-3 rounded-lg border border-emerald-100 min-h-[200px]\">\r\n            <div className=\"whitespace-pre-wrap\">\r\n              {formattedNewText}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ================= FULLSCREEN DIFF COMPONENT ================= */\r\n\r\nfunction FullscreenDiffViewer({ detail, onClose }: { detail: ComparisonDetail; onClose: () => void }) {\r\n  const [currentChangeIndex, setCurrentChangeIndex] = useState(0);\r\n  const changes = detail.changes;\r\n  const currentChange = changes[currentChangeIndex];\r\n\r\n  const handlePrev = () => {\r\n    setCurrentChangeIndex(prev => Math.max(0, prev - 1));\r\n  };\r\n\r\n  const handleNext = () => {\r\n    setCurrentChangeIndex(prev => Math.min(changes.length - 1, prev + 1));\r\n  };\r\n\r\n  const handleKeyDown = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') onClose();\r\n    if (e.key === 'ArrowLeft') handlePrev();\r\n    if (e.key === 'ArrowRight') handleNext();\r\n  };\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, []);\r\n\r\n  const getHighlightedOldText = () => {\r\n    const oldText = currentChange.old_text || '';\r\n    const newText = currentChange.new_text || '';\r\n    \r\n    const oldWords = oldText.split(/(\\s+)/);\r\n    const newWords = newText.split(/(\\s+)/).filter(w => w.trim().length > 0);\r\n    const newWordSet = new Set(newWords);\r\n    \r\n    const lines = oldText.split('\\n');\r\n    \r\n    return lines.map((line, lineIndex) => {\r\n      if (!line.trim()) return <div key={lineIndex} className=\"h-4\"></div>;\r\n      \r\n      const words = line.split(/(\\s+)/);\r\n      \r\n      return (\r\n        <div key={lineIndex} className=\"mb-2 last:mb-0\">\r\n          {words.map((word, wordIndex) => {\r\n            if (!newWordSet.has(word) && word.trim().length > 0) {\r\n              return (\r\n                <span\r\n                  key={`${lineIndex}-${wordIndex}`}\r\n                  className=\"bg-red-200 text-red-900 px-1 py-0.5 rounded border border-red-300 font-medium line-through decoration-red-700 decoration-2 mx-0.5\"\r\n                >\r\n                  {word}\r\n                </span>\r\n              );\r\n            }\r\n            return word;\r\n          })}\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  const getHighlightedNewText = () => {\r\n    const oldText = currentChange.old_text || '';\r\n    const newText = currentChange.new_text || '';\r\n    \r\n    const oldWords = oldText.split(/(\\s+)/).filter(w => w.trim().length > 0);\r\n    const newWords = newText.split(/(\\s+)/);\r\n    const oldWordSet = new Set(oldWords);\r\n    \r\n    const lines = newText.split('\\n');\r\n    \r\n    return lines.map((line, lineIndex) => {\r\n      if (!line.trim()) return <div key={lineIndex} className=\"h-4\"></div>;\r\n      \r\n      const words = line.split(/(\\s+)/);\r\n      \r\n      return (\r\n        <div key={lineIndex} className=\"mb-2 last:mb-0\">\r\n          {words.map((word, wordIndex) => {\r\n            if (!oldWordSet.has(word) && word.trim().length > 0) {\r\n              return (\r\n                <span\r\n                  key={`${lineIndex}-${wordIndex}`}\r\n                  className=\"bg-emerald-200 text-emerald-900 px-1 py-0.5 rounded border border-emerald-300 font-medium mx-0.5\"\r\n                >\r\n                  {word}\r\n                </span>\r\n              );\r\n            }\r\n            return word;\r\n          })}\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  const highlightedOldText = getHighlightedOldText();\r\n  const highlightedNewText = getHighlightedNewText();\r\n  const currentRiskBadge = riskBadge(currentChange.risk_level);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 bg-white flex flex-col\">\r\n      {/* Minimal Header */}\r\n      <div className=\"absolute top-0 left-0 right-0 z-10 bg-white/95 backdrop-blur-sm border-b border-gray-200\">\r\n        <div className=\"max-w-full px-4 py-3 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              title=\"ปิด (ESC)\"\r\n            >\r\n              <XMarkIcon className=\"h-5 w-5 text-gray-600\" />\r\n            </button>\r\n            <div>\r\n              <h2 className=\"font-semibold text-gray-900 line-clamp-1\">{detail.document_name}</h2>\r\n              <div className=\"flex items-center gap-2 text-xs text-gray-500\">\r\n                <span className=\"font-medium text-blue-600\">{detail.version_old_label}</span>\r\n                <span>→</span>\r\n                <span className=\"font-medium text-emerald-600\">{detail.version_new_label}</span>\r\n                <span className=\"mx-1\">•</span>\r\n                <span>Change {currentChangeIndex + 1} of {changes.length}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              onClick={handlePrev}\r\n              disabled={currentChangeIndex === 0}\r\n              className=\"p-2 disabled:opacity-30 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              title=\"ก่อนหน้า (←)\"\r\n            >\r\n              <ChevronLeftIcon className=\"h-5 w-5 text-gray-600\" />\r\n            </button>\r\n            \r\n            <div className=\"min-w-[80px] text-center text-sm font-medium text-gray-700\">\r\n              {currentChangeIndex + 1}/{changes.length}\r\n            </div>\r\n            \r\n            <button\r\n              onClick={handleNext}\r\n              disabled={currentChangeIndex === changes.length - 1}\r\n              className=\"p-2 disabled:opacity-30 hover:bg-gray-100 rounded-lg transition-colors\"\r\n              title=\"ถัดไป (→)\"\r\n            >\r\n              <ChevronRightIcon className=\"h-5 w-5 text-gray-600\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content - True Fullscreen */}\r\n      <div className=\"flex-1 grid grid-cols-2 pt-12 overflow-hidden\">\r\n        {/* Old Version Panel */}\r\n        <div className=\"h-full overflow-auto p-8 bg-gradient-to-b from-red-50/20 to-white\">\r\n          <div className=\"max-w-4xl mx-auto\">\r\n            <div className=\"mb-6\">\r\n              <div className=\"flex items-center gap-3 mb-2\">\r\n                <div className=\"h-4 w-4 bg-red-500 rounded-full\"></div>\r\n                <h3 className=\"text-lg font-bold text-red-700\">OLD VERSION</h3>\r\n                <span className=\"ml-auto text-sm font-medium bg-red-100 text-red-700 px-3 py-1 rounded-full\">\r\n                  {detail.version_old_label}\r\n                </span>\r\n              </div>\r\n              <p className=\"text-sm text-gray-500\">ข้อความที่ถูกลบหรือเปลี่ยนแปลงจะถูกไฮไลท์ด้วยสีแดง</p>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-xl p-6 border border-red-100 shadow-sm\">\r\n              <div className=\"text-gray-800 leading-relaxed text-base whitespace-pre-wrap\">\r\n                {currentChange.old_text ? highlightedOldText : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* New Version Panel */}\r\n        <div className=\"h-full overflow-auto p-8 bg-gradient-to-b from-emerald-50/20 to-white border-l border-gray-200\">\r\n          <div className=\"max-w-4xl mx-auto\">\r\n            <div className=\"mb-6\">\r\n              <div className=\"flex items-center gap-3 mb-2\">\r\n                <div className=\"h-4 w-4 bg-emerald-500 rounded-full\"></div>\r\n                <h3 className=\"text-lg font-bold text-emerald-700\">NEW VERSION</h3>\r\n                <span className=\"ml-auto text-sm font-medium bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full\">\r\n                  {detail.version_new_label}\r\n                </span>\r\n              </div>\r\n              <p className=\"text-sm text-gray-500\">ข้อความที่เพิ่มหรือเปลี่ยนแปลงจะถูกไฮไลท์ด้วยสีเขียว</p>\r\n            </div>\r\n            \r\n            <div className=\"bg-white rounded-xl p-6 border border-emerald-100 shadow-sm\">\r\n              <div className=\"text-gray-800 leading-relaxed text-base whitespace-pre-wrap\">\r\n                {currentChange.new_text ? highlightedNewText : <span className=\"text-gray-400 italic\">ไม่มีข้อความ</span>}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Minimal Footer with Info */}\r\n      <div className=\"absolute bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-gray-200\">\r\n        <div className=\"max-w-full px-4 py-2 flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4 text-sm text-gray-600\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"font-medium\">Section:</span>\r\n              <span className=\"font-semibold\">{currentChange.section_label || \"No Section\"}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"font-medium\">Type:</span>\r\n              {changeTypeBadge(currentChange.change_type)}\r\n            </div>\r\n            {currentRiskBadge && (\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"font-medium\">Risk:</span>\r\n                {currentRiskBadge}\r\n              </div>\r\n            )}\r\n          </div>\r\n          \r\n          <div className=\"text-xs text-gray-500\">\r\n            Press <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-300\">ESC</kbd> to close • \r\n            <kbd className=\"mx-1 px-1.5 py-0.5 bg-gray-100 rounded border border-gray-300\">←</kbd>\r\n            <kbd className=\"ml-1 px-1.5 py-0.5 bg-gray-100 rounded border border-gray-300\">→</kbd> to navigate\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ExpandableText({ text, title, maxLength = 300, type = \"normal\" }: { \r\n  text: string | null | undefined; \r\n  title?: string;\r\n  maxLength?: number;\r\n  type?: \"normal\" | \"ai\";\r\n}) {\r\n  const raw = normalizeText(text);\r\n  const [expanded, setExpanded] = useState(false);\r\n  const isLong = raw.length > maxLength;\r\n  const shown = expanded ? raw : raw.slice(0, maxLength) + (isLong ? \"...\" : \"\");\r\n\r\n  const bgColor = type === \"ai\" ? \"bg-gradient-to-br from-blue-50/80 to-blue-100/50\" : \"bg-gray-50\";\r\n  \r\n  const formattedText = shown ? shown.split('\\n').map((line, index) => (\r\n    <div key={index} className=\"mb-2 last:mb-0\">\r\n      {line}\r\n    </div>\r\n  )) : <span className=\"text-gray-400 italic\">ไม่มีข้อมูล</span>;\r\n\r\n  return (\r\n    <div className={`rounded-xl p-4 ${bgColor} border ${type === \"ai\" ? \"border-blue-200\" : \"border-gray-200\"}`}>\r\n      {title && (\r\n        <div className=\"flex items-center gap-2 mb-3\">\r\n          <span className=\"text-base font-bold text-gray-900\">{title}</span>\r\n        </div>\r\n      )}\r\n      <div className=\"text-base text-gray-800 whitespace-pre-wrap leading-relaxed font-normal\">\r\n        {formattedText}\r\n      </div>\r\n      {isLong && (\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setExpanded(!expanded)}\r\n          className=\"mt-3 px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-800 bg-white border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors\"\r\n        >\r\n          {expanded ? \"ย่อข้อความ\" : \"อ่านต่อ...\"}\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ntype MarkdownTextBlock = {\r\n  kind: \"text\";\r\n  text: string;\r\n};\r\n\r\ntype MarkdownTableBlock = {\r\n  kind: \"table\";\r\n  header: string[];\r\n  rows: string[][];\r\n};\r\n\r\ntype MarkdownBlock = MarkdownTextBlock | MarkdownTableBlock;\r\n\r\nconst MARKDOWN_TABLE_SEPARATOR = /^\\s*\\|?\\s*:?-{3,}:?\\s*(\\|\\s*:?-{3,}:?\\s*)+\\|?\\s*$/;\r\n\r\nfunction parseMarkdownTableRow(line: string) {\r\n  const trimmed = line.trim().replace(/^\\|/, \"\").replace(/\\|$/, \"\");\r\n  return trimmed.split(\"|\").map((cell) => cell.trim());\r\n}\r\n\r\nfunction parseMarkdownBlocks(text: string): MarkdownBlock[] {\n  const lines = text.split(/\\r?\\n/);\r\n  const blocks: MarkdownBlock[] = [];\r\n  let textBuffer: string[] = [];\r\n\r\n  const flushText = () => {\r\n    if (!textBuffer.length) return;\r\n    const merged = textBuffer.join(\"\\n\");\r\n    if (merged.trim().length > 0) {\r\n      blocks.push({ kind: \"text\", text: merged });\r\n    }\r\n    textBuffer = [];\r\n  };\r\n\r\n  let i = 0;\r\n  while (i < lines.length) {\r\n    const line = lines[i];\r\n    const next = i + 1 < lines.length ? lines[i + 1] : \"\";\r\n\r\n    if (line.includes(\"|\") && MARKDOWN_TABLE_SEPARATOR.test(next)) {\r\n      const header = parseMarkdownTableRow(line);\r\n      const rows: string[][] = [];\r\n      i += 2;\r\n\r\n      while (i < lines.length) {\r\n        const rowLine = lines[i];\r\n        if (!rowLine.trim() || !rowLine.includes(\"|\")) break;\r\n        rows.push(parseMarkdownTableRow(rowLine));\r\n        i += 1;\r\n      }\r\n\r\n      flushText();\r\n      if (header.length > 0) {\r\n        blocks.push({ kind: \"table\", header, rows });\r\n      }\r\n      continue;\r\n    }\r\n\r\n    textBuffer.push(line);\r\n    i += 1;\r\n  }\r\n\r\n  flushText();\n  return blocks;\n}\n\nfunction renderInlineMarkdown(text: string) {\n  const nodes: Array<string | JSX.Element> = [];\n  const pattern = /(`[^`]+`)|(\\*\\*[^*]+\\*\\*)|(\\[[^\\]]+\\]\\((https?:\\/\\/[^)\\s]+)\\))|(<https?:\\/\\/[^>\\s]+>)|((?<!\\()https?:\\/\\/[^\\s)]+)/g;\n  let lastIndex = 0;\n  let key = 0;\n  let match: RegExpExecArray | null;\n\n  while ((match = pattern.exec(text)) !== null) {\n    if (match.index > lastIndex) {\n      nodes.push(text.slice(lastIndex, match.index));\n    }\n\n    const token = match[0];\n    if (token.startsWith(\"`\")) {\n      nodes.push(\n        <code key={`code-${key++}`} className=\"rounded bg-gray-100 px-1 py-0.5 font-mono text-[0.92em]\">\n          {token.slice(1, -1)}\n        </code>,\n      );\n    } else if (token.startsWith(\"**\")) {\n      nodes.push(<strong key={`strong-${key++}`}>{token.slice(2, -2)}</strong>);\n    } else if (token.startsWith(\"[\")) {\n      const labelMatch = token.match(/^\\[([^\\]]+)\\]\\((https?:\\/\\/[^)\\s]+)\\)$/);\n      if (labelMatch) {\n        nodes.push(\n          <a\n            key={`link-${key++}`}\n            href={labelMatch[2]}\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            className=\"text-blue-600 underline break-all\"\n          >\n            {labelMatch[1]}\n          </a>,\n        );\n      } else {\n        nodes.push(token);\n      }\n    } else if (token.startsWith(\"<http\")) {\n      const href = token.slice(1, -1);\n      nodes.push(\n        <a\n          key={`link-${key++}`}\n          href={href}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n          className=\"text-blue-600 underline break-all\"\n        >\n          {href}\n        </a>,\n      );\n    } else if (token.startsWith(\"http\")) {\n      nodes.push(\n        <a\n          key={`link-${key++}`}\n          href={token}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n          className=\"text-blue-600 underline break-all\"\n        >\n          {token}\n        </a>,\n      );\n    } else {\n      nodes.push(token);\n    }\n\n    lastIndex = pattern.lastIndex;\n  }\n\n  if (lastIndex < text.length) {\n    nodes.push(text.slice(lastIndex));\n  }\n\n  return nodes;\n}\n\nfunction renderMarkdownTextBlock(text: string) {\n  const lines = text.split(/\\r?\\n/);\n  const elements: JSX.Element[] = [];\n  let i = 0;\n\n  while (i < lines.length) {\n    const line = lines[i];\n    const trimmed = line.trim();\n\n    if (!trimmed) {\n      i += 1;\n      continue;\n    }\n\n    if (trimmed.startsWith(\"```\")) {\n      const codeLines: string[] = [];\n      i += 1;\n      while (i < lines.length && !lines[i].trim().startsWith(\"```\")) {\n        codeLines.push(lines[i]);\n        i += 1;\n      }\n      if (i < lines.length) i += 1;\n      elements.push(\n        <pre key={`pre-${elements.length}`} className=\"overflow-x-auto rounded-lg bg-gray-900 p-3 text-xs text-gray-100 sm:text-sm\">\n          <code>{codeLines.join(\"\\n\")}</code>\n        </pre>,\n      );\n      continue;\n    }\n\n    const heading = trimmed.match(/^(#{1,6})\\s+(.*)$/);\n    if (heading) {\n      const level = heading[1].length;\n      const content = renderInlineMarkdown(heading[2]);\n      const cls = level <= 2 ? \"text-base font-bold\" : \"text-sm font-semibold\";\n      elements.push(\n        <div key={`h-${elements.length}`} className={`${cls} leading-relaxed`}>\n          {content}\n        </div>,\n      );\n      i += 1;\n      continue;\n    }\n\n    if (/^[-*]\\s+/.test(trimmed)) {\n      const items: string[] = [];\n      while (i < lines.length && /^[-*]\\s+/.test(lines[i].trim())) {\n        items.push(lines[i].trim().replace(/^[-*]\\s+/, \"\"));\n        i += 1;\n      }\n      elements.push(\n        <ul key={`ul-${elements.length}`} className=\"list-disc pl-5 space-y-1\">\n          {items.map((item, idx) => (\n            <li key={`uli-${idx}`}>{renderInlineMarkdown(item)}</li>\n          ))}\n        </ul>,\n      );\n      continue;\n    }\n\n    if (/^\\d+\\.\\s+/.test(trimmed)) {\n      const items: string[] = [];\n      while (i < lines.length && /^\\d+\\.\\s+/.test(lines[i].trim())) {\n        items.push(lines[i].trim().replace(/^\\d+\\.\\s+/, \"\"));\n        i += 1;\n      }\n      elements.push(\n        <ol key={`ol-${elements.length}`} className=\"list-decimal pl-5 space-y-1\">\n          {items.map((item, idx) => (\n            <li key={`oli-${idx}`}>{renderInlineMarkdown(item)}</li>\n          ))}\n        </ol>,\n      );\n      continue;\n    }\n\n    const paragraph: string[] = [];\n    while (\n      i < lines.length &&\n      lines[i].trim() &&\n      !/^(#{1,6})\\s+/.test(lines[i].trim()) &&\n      !/^[-*]\\s+/.test(lines[i].trim()) &&\n      !/^\\d+\\.\\s+/.test(lines[i].trim()) &&\n      !lines[i].trim().startsWith(\"```\")\n    ) {\n      paragraph.push(lines[i].trim());\n      i += 1;\n    }\n\n    elements.push(\n      <p key={`p-${elements.length}`} className=\"leading-relaxed\">\n        {renderInlineMarkdown(paragraph.join(\" \"))}\n      </p>,\n    );\n  }\n\n  return <div className=\"space-y-2\">{elements}</div>;\n}\n\nfunction ChatMessageContent({ content, role }: { content: string; role: \"user\" | \"assistant\" }) {\n  if (!content) return null;\r\n  if (role === \"user\") {\r\n    return <div className=\"whitespace-pre-wrap leading-relaxed\">{content}</div>;\r\n  }\r\n\r\n  const blocks = parseMarkdownBlocks(content);\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {blocks.map((block, blockIndex) => {\r\n        if (block.kind === \"text\") {\n          return (\n            <div key={blockIndex}>\n              {renderMarkdownTextBlock(block.text)}\n            </div>\n          );\n        }\n\r\n        const maxColumns = Math.max(\r\n          block.header.length,\r\n          ...block.rows.map((row) => row.length),\r\n        );\r\n        const headerCells = Array.from({ length: maxColumns }, (_, colIndex) => block.header[colIndex] ?? \"\");\r\n\r\n        return (\r\n          <div key={blockIndex} className=\"overflow-x-auto rounded-lg border border-gray-200\">\r\n            <table className=\"min-w-full border-collapse text-xs sm:text-sm\">\r\n              <thead className=\"bg-gray-100\">\r\n                <tr>\r\n                  {headerCells.map((cell, colIndex) => (\r\n                    <th\r\n                      key={`h-${blockIndex}-${colIndex}`}\r\n                      className=\"border border-gray-200 px-3 py-2 text-left font-semibold text-gray-700\"\n                    >\n                      {cell ? renderInlineMarkdown(cell) : \"-\"}\n                    </th>\n                  ))}\n                </tr>\n              </thead>\r\n              <tbody className=\"bg-white\">\r\n                {block.rows.length > 0 ? (\r\n                  block.rows.map((row, rowIndex) => (\r\n                    <tr key={`r-${blockIndex}-${rowIndex}`} className=\"odd:bg-gray-50/60\">\r\n                      {headerCells.map((_, colIndex) => (\r\n                        <td\r\n                          key={`c-${blockIndex}-${rowIndex}-${colIndex}`}\n                          className=\"border border-gray-200 px-3 py-2 align-top text-gray-800\"\n                        >\n                          {row[colIndex] ? renderInlineMarkdown(row[colIndex]) : \"\"}\n                        </td>\n                      ))}\n                    </tr>\n                  ))\r\n                ) : (\r\n                  <tr>\r\n                    {headerCells.map((_, colIndex) => (\r\n                      <td\r\n                        key={`empty-${blockIndex}-${colIndex}`}\r\n                        className=\"border border-gray-200 px-3 py-2 text-gray-400 italic\"\r\n                      >\r\n                        -\r\n                      </td>\r\n                    ))}\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ================= AI CHAT COMPONENT ================= */\r\n\r\nfunction AIChat({ change }: { change: ChangeItem }) {\n  const STATUS_PREFIX = \"__STATUS__:\"\n\n  const [chatOpen, setChatOpen] = useState(false)\n\r\n  const [messages, setMessages] = useState<\r\n    { role: \"user\" | \"assistant\", content: string }[]\r\n  >([])\r\n\r\n  const [input, setInput] = useState(\"\")\n  const [loading, setLoading] = useState(false)\n  const [chatError, setChatError] = useState<string | null>(null)\n  const [assistantStatus, setAssistantStatus] = useState(\"\")\n\r\n  const bottomRef = useRef<HTMLDivElement>(null)\r\n  const scrollRef = useRef<HTMLDivElement>(null)\r\n\r\n  const sendChat = async () => {\n\n    if (loading) return\n\n    const question = input.trim()\n    if (!question) return\r\n\r\n    setInput(\"\")\n    setLoading(true)\n    setChatError(null)\n    setAssistantStatus(\"กำลังวิเคราะห์คำถาม...\")\n\r\n    setMessages(prev => [...prev, { role: \"user\", content: question }])\r\n    setMessages(prev => [...prev, { role: \"assistant\", content: \"\" }])\r\n\r\n    try {\r\n\r\n      const res = await fetch(`${API_BASE_CHAT}/changes/${change.id}/chat`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"text/event-stream\",\n        },\n        cache: \"no-store\",\n        body: JSON.stringify({ question }),\n      })\n\r\n      if (!res.ok) throw new Error(`Chat failed (${res.status})`)\r\n\r\n      const reader = res.body?.getReader()\r\n      if (!reader) throw new Error(\"No stream reader\")\r\n\r\n      const decoder = new TextDecoder(\"utf-8\")\n\n      let done = false\n      let fullText = \"\"\n      let buffer = \"\"\n      let sawSseFrame = false\n      const parseSsePart = (part: string): { eventName: string; payload: string } => {\n        const lines = part.split(/\\r?\\n/)\n        let eventName = \"message\"\n        const dataLines: string[] = []\n\n        for (const line of lines) {\n          if (line.startsWith(\"event:\")) {\n            eventName = line.slice(6).trim()\n            continue\n          }\n          if (!line.startsWith(\"data:\")) continue\n          dataLines.push(line.startsWith(\"data: \") ? line.slice(6) : line.slice(5))\n        }\n\n        return { eventName, payload: dataLines.join(\"\\n\") }\n      }\n\r\n      while (!done) {\r\n\r\n        const { value, done: doneReading } = await reader.read()\r\n        done = doneReading\r\n\r\n        const chunkText = decoder.decode(value || new Uint8Array(), { stream: true })\n        buffer += chunkText\n\r\n        // ⭐ แยก SSE event\r\n        const parts = buffer.split(/\\r?\\n\\r?\\n/)\n        buffer = parts.pop() || \"\"\n        let appended = false\n\n        for (const part of parts) {\n          const { eventName, payload } = parseSsePart(part)\n          if (!payload) continue\n\n          sawSseFrame = true\n\n          if (eventName === \"status\" || payload.startsWith(STATUS_PREFIX)) {\n            const message = payload.startsWith(STATUS_PREFIX)\n              ? payload.slice(STATUS_PREFIX.length).trim()\n              : payload.trim()\n            if (message) setAssistantStatus(message)\n            continue\n          }\n\n          fullText += payload\n          appended = true\n        }\n\r\n        if (!sawSseFrame && chunkText) {\n          fullText += chunkText\n          appended = true\n        }\n\n        if (done && buffer) {\n          if (buffer.includes(\"data:\")) {\n            const { eventName, payload } = parseSsePart(buffer)\n            if (payload) {\n              if (eventName === \"status\" || payload.startsWith(STATUS_PREFIX)) {\n                const message = payload.startsWith(STATUS_PREFIX)\n                  ? payload.slice(STATUS_PREFIX.length).trim()\n                  : payload.trim()\n                if (message) setAssistantStatus(message)\n              } else {\n                fullText += payload\n                appended = true\n              }\n            }\n          } else if (!sawSseFrame) {\n            fullText += buffer\n            appended = true\n          }\n          buffer = \"\"\n        }\n\n        // realtime update\n        if (appended) {\n          setMessages(prev => {\n            const copy = [...prev]\n            copy[copy.length - 1].content = fullText\n            return copy\n          })\n        }\n      }\r\n\r\n    } catch (e: any) {\r\n\r\n      setChatError(e?.message || \"ส่งคำถามไม่สำเร็จ\")\r\n\r\n      setMessages(prev => {\r\n        const copy = [...prev]\r\n        copy[copy.length - 1].content = \"❌ เกิดข้อผิดพลาด\"\r\n        return copy\r\n      })\r\n\r\n    } finally {\n      setLoading(false)\n      setAssistantStatus(\"\")\n    }\n  }\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n\r\n      {/* ================= AI COMMENT + SUGGESTION (เหมือนเดิม) ================= */}\r\n      <div className=\"grid md:grid-cols-2 gap-4\">\r\n\r\n        <div className=\"rounded-xl overflow-hidden border border-blue-200 bg-gradient-to-br from-blue-50/80 to-white shadow-sm\">\r\n          <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 px-4 py-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <InformationCircleIcon className=\"h-5 w-5 text-white\" />\r\n                <h3 className=\"text-base font-bold text-white\">ความคิดเห็นจาก AI</h3>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4\">\r\n            <ExpandableText text={change.ai_comment} type=\"ai\" />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"rounded-xl overflow-hidden border border-amber-200 bg-gradient-to-br from-amber-50/80 to-white shadow-sm\">\r\n          <div className=\"bg-gradient-to-r from-amber-600 to-amber-700 px-4 py-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <LightBulbIcon className=\"h-5 w-5 text-white\" />\r\n                <h3 className=\"text-base font-bold text-white\">คำแนะนำจาก AI</h3>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"p-4\">\r\n            <ExpandableText text={change.ai_suggestion} type=\"ai\" />\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      {/* ================= CHAT BUBBLE ================= */}\r\n      <div className=\"rounded-xl border border-purple-200 overflow-hidden bg-gradient-to-br from-purple-50/30 to-white shadow-sm\">\r\n\r\n        <button\r\n          onClick={() => setChatOpen(!chatOpen)}\r\n          className=\"w-full px-4 py-3 bg-gradient-to-r from-purple-600 to-purple-700 flex items-center justify-between\"\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            <ChatBubbleLeftRightIcon className=\"h-5 w-5 text-white\" />\r\n            <span className=\"text-base font-bold text-white\">\r\n              ถาม AI เพิ่มเติมเกี่ยวกับจุดนี้\r\n            </span>\r\n          </div>\r\n          <span className=\"text-white font-bold\">{chatOpen ? \"▲\" : \"▼\"}</span>\r\n        </button>\r\n\r\n        {chatOpen && (\r\n          <div className=\"flex flex-col h-[420px]\">\r\n\r\n            <div\r\n              ref={scrollRef}\r\n              className=\"flex-1 overflow-auto p-4 space-y-3 bg-gray-50\"\r\n            >\r\n              {messages.map((m, i) => (\r\n                <div\r\n                  key={i}\r\n                  className={`flex ${m.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\r\n                >\r\n                  <div\r\n                    className={`\r\n                      px-4 py-2 rounded-2xl max-w-[75%]\r\n                      text-sm shadow\r\n                      ${m.role === \"user\"\r\n                        ? \"bg-blue-600 text-white\"\r\n                        : \"bg-white border border-gray-200\"}\r\n                    `}\r\n                  >\r\n                    <ChatMessageContent\r\n                      role={m.role}\r\n                      content={m.content || (loading && m.role === \"assistant\" ? (assistantStatus || \"Thinking...\") : \"\")}\n                    />\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {chatError && (\r\n              <div className=\"px-4 pb-2 text-sm text-red-600\">\r\n                {chatError}\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"border-t p-3 flex gap-2 bg-white\">\r\n              <input\r\n                value={input}\r\n                onChange={e => setInput(e.target.value)}\r\n                placeholder=\"พิมพ์คำถาม...\"\r\n                className=\"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-900 placeholder:text-gray-500 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                onKeyDown={e => {\r\n                  if (e.key === \"Enter\") sendChat()\r\n                }}\r\n              />\r\n              <button\r\n                onClick={sendChat}\r\n                disabled={loading}\r\n                className=\"bg-blue-600 text-white px-4 rounded-lg text-sm font-medium\"\r\n              >\r\n                ส่ง\r\n              </button>\r\n            </div>\r\n\r\n          </div>\r\n        )}\r\n\r\n      </div>\r\n\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n/* ================= MAIN PAGE ================= */\r\n\r\nexport default function CompareReportPage() {\r\n  const { id } = useParams<{ id: string }>();\r\n  const [detail, setDetail] = useState<ComparisonDetail | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [riskFilter, setRiskFilter] = useState<\"ALL\" | RiskLevel>(\"ALL\");\r\n  const [typeFilter, setTypeFilter] = useState<\"ALL\" | ChangeType>(\"ALL\");\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [showFullscreen, setShowFullscreen] = useState(false);\r\n  const [fullscreenChangeIndex, setFullscreenChangeIndex] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (id) loadDetail();\r\n  }, [id]);\r\n\r\n  const loadDetail = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await fetch(`${API_BASE}/comparisons/${id}`, { cache: \"no-store\" });\r\n      if (!res.ok) throw new Error(`Failed to load (${res.status})`);\r\n      const data: ComparisonDetail = await res.json();\r\n      setDetail(data);\r\n    } catch (err: any) {\r\n      setError(err?.message || \"โหลดข้อมูลไม่สำเร็จ\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleOpenFullscreen = (index: number) => {\r\n    setFullscreenChangeIndex(index);\r\n    setShowFullscreen(true);\r\n  };\r\n\r\n  const filteredChanges = useMemo(() => {\r\n    const changes = detail?.changes || [];\r\n    const query = searchQuery.trim();\r\n\r\n    return changes.filter(c => {\r\n      if (riskFilter !== \"ALL\") {\r\n        const lv = (c.risk_level || \"LOW\").toUpperCase();\r\n        if (lv !== riskFilter) return false;\r\n      }\r\n\r\n      if (typeFilter !== \"ALL\") {\r\n        if (c.change_type !== typeFilter) return false;\r\n      }\r\n\r\n      if (query.length > 0) {\r\n        const hay = [\r\n          c.section_label,\r\n          c.old_text,\r\n          c.new_text,\r\n          c.ai_comment,\r\n          c.ai_suggestion,\r\n          c.risk_reason,\r\n          c.change_type,\r\n          c.risk_level,\r\n        ]\r\n          .map(x => normalizeText(x as any))\r\n          .join(\" | \");\r\n\r\n        if (!contains(hay, query)) return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }, [detail?.changes, searchQuery, riskFilter, typeFilter]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <ArrowPathIcon className=\"h-12 w-12 animate-spin text-blue-600 mx-auto\" />\r\n          <p className=\"mt-4 text-lg text-gray-700 font-medium\">กำลังโหลดรายงาน...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !detail) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center p-6\">\r\n        <div className=\"bg-white border border-red-200 rounded-xl p-8 max-w-md shadow-sm\">\r\n          <ExclamationTriangleIcon className=\"h-12 w-12 text-red-500 mx-auto\" />\r\n          <h2 className=\"text-xl font-bold text-gray-900 mt-4 text-center\">ไม่พบรายงาน</h2>\r\n          <p className=\"text-gray-600 mt-2 text-center\">{error || \"ไม่พบข้อมูลการเปรียบเทียบนี้\"}</p>\r\n          <button\r\n            onClick={loadDetail}\r\n            className=\"mt-6 w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-sm\"\r\n          >\r\n            โหลดใหม่\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\n    <>\r\n      {showFullscreen && detail && (\r\n        <FullscreenDiffViewer \r\n          detail={detail} \r\n          onClose={() => setShowFullscreen(false)} \r\n        />\r\n      )}\r\n      \r\n      <div className=\"min-h-screen bg-gradient-to-b from-gray-50/50 to-gray-100 p-4 md:p-6\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          {/* Header */}\r\n          <div className=\"mb-8\">\r\n            <div className=\"bg-white rounded-2xl border border-gray-200 shadow-sm p-6\">\r\n              <div className=\"flex flex-col lg:flex-row lg:items-start justify-between gap-6\">\r\n                <div className=\"flex-1\">\r\n                  <h1 className=\"text-2xl lg:text-3xl font-bold text-gray-900 mb-3\">\r\n                    {detail.document_name}\r\n                  </h1>\r\n                  <div className=\"flex flex-wrap items-center gap-3 text-gray-700 mb-4\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm rounded-lg font-semibold shadow-sm\">\r\n                        {detail.version_old_label}\r\n                      </span>\r\n                      <span className=\"text-gray-500\">→</span>\r\n                      <span className=\"px-3 py-1.5 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm rounded-lg font-semibold shadow-sm\">\r\n                        {detail.version_new_label}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <span className=\"text-gray-500\">•</span>\r\n                      {formatDateTime(detail.created_at)}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 text-sm\">\r\n                      <span className=\"text-gray-500\">•</span>\r\n                      <span>ID: {detail.id}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex flex-col items-start lg:items-end gap-4\">\r\n                  <div className=\"text-right\">\r\n                    <div className=\"text-sm text-gray-600 font-medium mb-1\">ความเสี่ยงรวม</div>\r\n                    <div className={`text-2xl font-bold ${\r\n                      detail.overall_risk_level?.includes(\"HIGH\") ? \"text-red-600\" :\r\n                      detail.overall_risk_level?.includes(\"MEDIUM\") ? \"text-amber-600\" :\r\n                      \"text-emerald-600\"\r\n                    }`}>\r\n                      {detail.overall_risk_level || \"ไม่ระบุ\"}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex flex-col sm:flex-row gap-2\">\r\n                    \r\n                    \r\n                    <button\r\n                      onClick={() => setShowFilters(!showFilters)}\r\n                      className=\"flex items-center gap-2 px-4 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium shadow-sm\"\r\n                    >\r\n                      <AdjustmentsHorizontalIcon className=\"h-4 w-4\" />\r\n                      ฟิลเตอร์\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n\r\n            {/* AI Summary */}\r\n            {detail.summary_text && (\r\n              <div className=\"mt-6 bg-gradient-to-br from-blue-50/80 to-white rounded-2xl border border-blue-200 shadow-sm p-6\">\r\n                <div className=\"flex items-center gap-3 mb-4\">\r\n                  <DocumentMagnifyingGlassIcon className=\"h-6 w-6 text-blue-600\" />\r\n                  <h2 className=\"text-xl font-bold text-gray-900\">สรุปผลการวิเคราะห์</h2>\r\n                </div>\r\n                <div className=\"text-base text-gray-800 leading-relaxed bg-white/50 border border-blue-100 rounded-xl p-4\">\n                  <ChatMessageContent role=\"assistant\" content={detail.summary_text} />\n                </div>\n              </div>\n            )}\n          </div>\r\n\r\n          {/* Filters */}\r\n          {showFilters && (\r\n            <div className=\"mb-6 bg-white rounded-2xl border border-gray-200 shadow-sm p-6\">\r\n              <div className=\"flex items-center justify-between mb-4\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <FunnelIcon className=\"h-5 w-5 text-gray-700\" />\r\n                  <h3 className=\"font-bold text-gray-900\">ค้นหาและกรองข้อมูล</h3>\r\n                </div>\r\n                <button\r\n                  onClick={() => setShowFilters(false)}\r\n                  className=\"text-sm text-gray-600 hover:text-gray-900\"\r\n                >\r\n                  ปิด\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">ค้นหาคำ</label>\r\n                  <div className=\"relative\">\r\n                    <MagnifyingGlassIcon className=\"h-5 w-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2\" />\r\n                    <input\r\n                      value={searchQuery}\r\n                      onChange={(e) => setSearchQuery(e.target.value)}\r\n                      placeholder=\"ค้นหาคำในรายการเปลี่ยนแปลง...\"\r\n                      className=\"w-full pl-10 pr-3 py-3 text-base border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">กรองความเสี่ยง</label>\r\n                    <select\r\n                      value={riskFilter}\r\n                      onChange={(e) => setRiskFilter(e.target.value as any)}\r\n                      className=\"w-full px-3 py-3 text-base border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    >\r\n                      <option value=\"ALL\">ความเสี่ยงทั้งหมด</option>\r\n                      <option value=\"HIGH\">HIGH</option>\r\n                      <option value=\"MEDIUM\">MEDIUM</option>\r\n                      <option value=\"LOW\">LOW</option>\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">กรองประเภท</label>\r\n                    <select\r\n                      value={typeFilter}\r\n                      onChange={(e) => setTypeFilter(e.target.value as any)}\r\n                      className=\"w-full px-3 py-3 text-base border border-gray-300 rounded-xl bg-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    >\r\n                      <option value=\"ALL\">ประเภททั้งหมด</option>\r\n                      <option value=\"ADDED\">ADDED</option>\r\n                      <option value=\"REMOVED\">REMOVED</option>\r\n                      <option value=\"MODIFIED\">MODIFIED</option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"mt-4 text-sm text-gray-600\">\r\n                แสดง {filteredChanges.length} จาก {detail.changes.length} รายการ\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Changes List */}\r\n          <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h2 className=\"text-xl font-bold text-gray-900\">รายการเปลี่ยนแปลง</h2>\r\n              <div className=\"text-sm text-gray-600\">\r\n                {filteredChanges.length} รายการ\r\n              </div>\r\n            </div>\r\n\r\n            {filteredChanges.length === 0 ? (\r\n              <div className=\"bg-white rounded-2xl border border-gray-200 p-8 text-center shadow-sm\">\r\n                <p className=\"text-lg text-gray-500\">ไม่พบรายการเปลี่ยนแปลงตามเงื่อนไขที่เลือก</p>\r\n              </div>\r\n            ) : (\r\n              filteredChanges.map((change, index) => (\r\n                <div key={change.id} className=\"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden\">\r\n                  {/* Header */}\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-white border-b border-gray-200 p-5\">\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-3\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {changeTypeBadge(change.change_type)}\r\n                        <h3 className=\"text-lg font-bold text-gray-900\">\r\n                          {change.section_label || \"ไม่มีหัวข้อ\"}\r\n                        </h3>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {riskBadge(change.risk_level)}\r\n                        <span className=\"text-sm text-gray-500\">ID: {change.id}</span>\r\n                        <button\r\n                          onClick={() => handleOpenFullscreen(index)}\r\n                          className=\"flex items-center gap-2 px-3 py-1.5 text-sm bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-sm\"\r\n                        >\r\n                          <ArrowsPointingOutIcon className=\"h-4 w-4\" />\r\n                          เปิดเต็มจอ\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Content */}\r\n                  <div className=\"p-5 space-y-6\">\r\n                    {/* Diff View with highlighted changes */}\r\n                    <div>\r\n                      <h4 className=\"text-base font-bold text-gray-800 mb-3\">การเปลี่ยนแปลงข้อความ</h4>\r\n                      <DiffView\r\n                        oldText={normalizeText(change.old_text)}\r\n                        newText={normalizeText(change.new_text)}\r\n                      />\r\n                    </div>\r\n\r\n                    {/* AI Analysis Section */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-3 mb-4\">\r\n                        <div className=\"h-8 w-1 bg-gradient-to-b from-purple-500 to-purple-600 rounded-full\"></div>\r\n                        <h4 className=\"text-lg font-bold text-gray-900\">การวิเคราะห์ด้วย AI</h4>\r\n                      </div>\r\n                      <AIChat change={change} />\r\n                    </div>\r\n\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}